# 端口配置技术文档

## 概述
本文档详细说明了部门地图系统中各个端口的功能、用途和相互关系，确保开发和部署过程中的端口配置清晰明确。

## 端口分配表

| 端口 | 服务名称 | 功能描述 | 技术栈 | 状态 |
|------|----------|----------|--------|------|
| 5173 | 前端主应用 | 部门地图主界面，包含登录、地图展示、员工管理等核心功能 | Vite + React + TypeScript | 活跃 |
| 3001 | 服务器管理界面 | M1服务器监控和管理界面，独立的管理后台 | Vite + React + TypeScript | 活跃 |
| 8080 | 后端API服务 | RESTful API接口，提供数据服务和业务逻辑 | Express + TypeScript + PostgreSQL | 活跃 |
| 5432 | PostgreSQL数据库 | 主数据库服务 | PostgreSQL | 活跃 |

## 详细端口说明

### 5173 - 前端主应用
- **功能**: 部门地图系统的主要用户界面
- **包含模块**:
  - 用户登录和认证
  - 部门地图可视化
  - 员工信息管理
  - 工位分配管理
  - 实时数据展示
- **技术特点**:
  - 使用Vite作为开发服务器
  - React 18 + TypeScript
  - Tailwind CSS样式框架
  - Zustand状态管理
- **访问地址**: http://localhost:5173

### 3001 - 服务器管理界面
- **功能**: M1服务器的监控和管理后台
- **包含模块**:
  - 服务器状态监控
  - 系统资源使用情况
  - 服务管理和控制
  - 日志查看和分析
- **技术特点**:
  - 独立的Vite配置
  - 专用的React组件
  - 实时数据更新
  - 响应式设计
- **访问地址**: http://localhost:3001
- **注意**: 此端口之前错误配置为3000，已修正为3001避免冲突

### 8080 - 后端API服务
- **功能**: 提供所有业务逻辑和数据服务
- **API端点**:
  - `/api/health` - 健康检查
  - `/api/auth/login` - 用户登录
  - `/api/auth/logout` - 用户登出
  - `/api/employees` - 员工管理
  - `/api/departments` - 部门管理
  - `/api/workstations` - 工位管理
- **技术特点**:
  - Express.js框架
  - TypeScript开发
  - JWT认证机制
  - PostgreSQL数据库连接
  - RESTful API设计
- **访问地址**: http://localhost:8080

### 5432 - PostgreSQL数据库
- **功能**: 主数据库服务
- **数据表**:
  - users - 用户信息
  - departments - 部门信息
  - employees - 员工信息
  - workstations - 工位信息
- **连接配置**: 通过环境变量配置连接参数

## 服务间通信关系

```
前端主应用 (5173)
    ↓ HTTP/HTTPS
后端API服务 (8080)
    ↓ SQL
PostgreSQL数据库 (5432)

服务器管理界面 (3001)
    ↓ HTTP/HTTPS (可选)
后端API服务 (8080)
```

## WebSocket通信配置

### 当前状态
- WebSocket服务器: 计划集成到8080端口的Express服务器
- 连接端点: `ws://localhost:8080/ws`
- 用途: 实时数据同步、状态更新通知

### 通信流程
1. 前端应用(5173)建立WebSocket连接到8080端口
2. 服务器管理界面(3001)可选择性连接WebSocket获取实时状态
3. 后端服务(8080)广播数据变更事件
4. 前端接收事件并更新UI状态

## 开发环境启动顺序

1. **启动数据库服务** (端口5432)
   ```bash
   # PostgreSQL服务需要先启动
   ```

2. **启动后端API服务** (端口8080)
   ```bash
   npm run server:dev
   ```

3. **启动前端服务** (端口5173和3001)
   ```bash
   npm run dev:all
   # 或分别启动
   npm run client:dev      # 端口5173
   npm run server-management:dev  # 端口3001
   ```

## 生产环境部署注意事项

### 端口映射
- 生产环境可能需要不同的端口配置
- 建议使用环境变量控制端口设置
- 考虑使用反向代理(如Nginx)统一入口

### 安全配置
- API服务(8080)应配置CORS策略
- 生产环境禁用开发模式的自动打开浏览器
- 数据库(5432)不应直接暴露给外网

## 故障排除

### 端口冲突
- 检查端口是否被其他进程占用
- 使用 `netstat -ano | findstr :端口号` 查看端口使用情况
- 修改配置文件中的端口设置

### 跨域问题
- 确保后端API配置了正确的CORS策略
- 检查前端请求的目标地址是否正确

### WebSocket连接失败
- 验证WebSocket服务器是否正常启动
- 检查防火墙设置
- 确认客户端连接地址正确

## 配置文件位置

- 前端主应用: `vite.config.ts`
- 服务器管理界面: `vite.server-management.config.ts`
- 后端服务: `api/server.ts`
- 环境变量: `.env`

## 更新日志

- 2024-01-XX: 修正服务器管理界面端口从3000改为3001
- 2024-01-XX: 创建端口配置技术文档
- 2024-01-XX: 规范化端口分配和服务间通信

---

**维护说明**: 本文档应随着系统架构变更及时更新，确保端口配置信息的准确性。