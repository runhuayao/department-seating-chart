# éƒ¨é—¨åœ°å›¾ç³»ç»Ÿ v2.0 å¼€å‘è§„èŒƒ

## ğŸ“‹ æ¦‚è¿°

æœ¬æ–‡æ¡£å®šä¹‰äº†éƒ¨é—¨åœ°å›¾ç³»ç»Ÿv2.0åŠä»¥ä¸Šç‰ˆæœ¬çš„ä»£ç ä¿®æ”¹æµç¨‹ã€å¼€å‘è§„èŒƒå’Œè´¨é‡æ ‡å‡†ã€‚æ‰€æœ‰å¼€å‘äººå‘˜å¿…é¡»ä¸¥æ ¼éµå¾ªè¿™äº›è§„èŒƒï¼Œç¡®ä¿ä»£ç è´¨é‡å’Œé¡¹ç›®çš„å¯ç»´æŠ¤æ€§ã€‚

## ğŸ”„ ä»£ç ä¿®æ”¹æµç¨‹è§„èŒƒ

### 1. æŠ€æœ¯æ–‡æ¡£ä¸æ—¥å¿—è¦æ±‚

#### 1.1 æ–‡æ¡£åˆ›å»ºè§„èŒƒ
- **å®Œæ•´ä¸Šä¸‹æ–‡**: åˆ›å»ºæ–°ç‰ˆæœ¬æ–‡æ¡£æ—¶å¿…é¡»åŒ…å«å®Œæ•´çš„ä¸Šä¸‹æ–‡ä¿¡æ¯
  - ä¿®æ”¹èƒŒæ™¯å’ŒåŸå› 
  - ä¿®æ”¹ç›®çš„å’Œé¢„æœŸæ•ˆæœ
  - å½±å“èŒƒå›´å’Œç›¸å…³æ¨¡å—
  - é£é™©è¯„ä¼°å’Œå›æ»šæ–¹æ¡ˆ

#### 1.2 åˆ†æ­¥è®°å½•æ–¹å¼
- **æ“ä½œå¯è¿½æº¯**: ç¡®ä¿æ¯ä¸ªæ“ä½œæ­¥éª¤éƒ½å¯è¿½æº¯
  - è®°å½•å…·ä½“çš„æ–‡ä»¶ä¿®æ”¹
  - è®°å½•é…ç½®å˜æ›´
  - è®°å½•æ•°æ®åº“ç»“æ„å˜åŒ–
  - è®°å½•ä¾èµ–åŒ…æ›´æ–°

#### 1.3 é—®é¢˜æ ‡æ³¨æœºåˆ¶
- **é‡å¤é—®é¢˜ç®¡ç†**: å¯¹é‡å¤å‡ºç°ä½†æœªå½»åº•è§£å†³çš„é—®é¢˜
  - åœ¨rulesæ–‡æ¡£ä¸­æ˜ç¡®æ ‡æ³¨
  - è®¾ç½®æé†’æœºåˆ¶
  - å»ºç«‹é—®é¢˜è·Ÿè¸ªè¡¨
  - å®šæœŸå›é¡¾å’Œè§£å†³

### 2. ç‰ˆæœ¬æ§åˆ¶è§„èŒƒ

#### 2.1 åˆ†æ”¯ç®¡ç†
```bash
# ä¸»åˆ†æ”¯
main/master     # ç”Ÿäº§ç¯å¢ƒä»£ç 
develop         # å¼€å‘ç¯å¢ƒä»£ç 

# åŠŸèƒ½åˆ†æ”¯
feature/åŠŸèƒ½åç§°  # æ–°åŠŸèƒ½å¼€å‘
fix/é—®é¢˜æè¿°     # é—®é¢˜ä¿®å¤
hotfix/ç´§æ€¥ä¿®å¤  # ç´§æ€¥ä¿®å¤
```

#### 2.2 æäº¤è§„èŒƒ
```bash
# æäº¤æ ¼å¼
<type>(<scope>): <subject>

<body>

<footer>

# ç¤ºä¾‹
feat(search): å®ç°å…¨éƒ¨é—¨è·¨åŸŸæœç´¢åŠŸèƒ½

- æ·»åŠ å¤šæ¡ä»¶ç»„åˆæŸ¥è¯¢
- ä¼˜åŒ–æœç´¢æ€§èƒ½
- ä¿®å¤æŠ€æœ¯éƒ¨æœç´¢é™åˆ¶é—®é¢˜

Closes #123
```

#### 2.3 æäº¤ç±»å‹
- `feat`: æ–°åŠŸèƒ½
- `fix`: é—®é¢˜ä¿®å¤
- `docs`: æ–‡æ¡£æ›´æ–°
- `style`: ä»£ç æ ¼å¼
- `refactor`: ä»£ç é‡æ„
- `perf`: æ€§èƒ½ä¼˜åŒ–
- `test`: æµ‹è¯•ç›¸å…³
- `chore`: æ„å»ºå·¥å…·

## ğŸ—ï¸ æ¶æ„è®¾è®¡è§„èŒƒ

### 1. æ•°æ®åº“è®¾è®¡è§„èŒƒ

#### 1.1 å¤šæ•°æ®åº“æ”¯æŒ
```typescript
// æ•°æ®åº“æ¨¡å¼é…ç½®
interface DatabaseConfig {
  mode: 'postgresql' | 'sqlite' | 'memory';
  connection: ConnectionConfig;
  options: DatabaseOptions;
}

// ç»Ÿä¸€æ•°æ®åº“æ¥å£
interface DatabaseInterface {
  query(sql: string, params?: any[]): Promise<any>;
  transaction(callback: Function): Promise<any>;
  testConnection(): Promise<boolean>;
  close(): Promise<void>;
}
```

#### 1.2 ç´¢å¼•ç®¡ç†è§„èŒƒ
- **å…¨é‡ç´¢å¼•**: ç¡®ä¿æ‰€æœ‰éƒ¨é—¨äººå‘˜æ•°æ®å»ºç«‹ç´¢å¼•
- **æœç´¢ä¼˜åŒ–**: ä¸ºæœç´¢å­—æ®µå»ºç«‹å¤åˆç´¢å¼•
- **æ€§èƒ½ç›‘æ§**: å®šæœŸæ£€æŸ¥ç´¢å¼•ä½¿ç”¨æƒ…å†µ
- **ç´¢å¼•ç»´æŠ¤**: å®šæ—¶é‡å»ºå’Œä¼˜åŒ–ç´¢å¼•

### 2. å‰ç«¯æ¶æ„è§„èŒƒ

#### 2.1 ç»„ä»¶è®¾è®¡åŸåˆ™
- **å•ä¸€èŒè´£**: æ¯ä¸ªç»„ä»¶åªè´Ÿè´£ä¸€ä¸ªåŠŸèƒ½
- **å¯å¤ç”¨æ€§**: æå–å…¬å…±ç»„ä»¶å’Œé€»è¾‘
- **æ€§èƒ½ä¼˜åŒ–**: ä½¿ç”¨React.memoå’ŒuseMemo
- **ç±»å‹å®‰å…¨**: ä¸¥æ ¼çš„TypeScriptç±»å‹å®šä¹‰

#### 2.2 çŠ¶æ€ç®¡ç†è§„èŒƒ
```typescript
// ä½¿ç”¨Zustandè¿›è¡ŒçŠ¶æ€ç®¡ç†
interface AppState {
  // ç”¨æˆ·çŠ¶æ€
  user: UserState;
  // éƒ¨é—¨çŠ¶æ€
  departments: DepartmentState;
  // æœç´¢çŠ¶æ€
  search: SearchState;
  // UIçŠ¶æ€
  ui: UIState;
}

// çŠ¶æ€æ›´æ–°è§„èŒƒ
const useAppStore = create<AppState>((set, get) => ({
  // çŠ¶æ€å®šä¹‰
  user: initialUserState,
  
  // åŠ¨ä½œå®šä¹‰
  actions: {
    updateUser: (user: User) => set({ user }),
    resetState: () => set(initialState),
  },
}));
```

### 3. åç«¯æ¶æ„è§„èŒƒ

#### 3.1 APIè®¾è®¡è§„èŒƒ
```typescript
// RESTful APIè§„èŒƒ
GET    /api/departments          # è·å–éƒ¨é—¨åˆ—è¡¨
POST   /api/departments          # åˆ›å»ºéƒ¨é—¨
GET    /api/departments/:id      # è·å–éƒ¨é—¨è¯¦æƒ…
PUT    /api/departments/:id      # æ›´æ–°éƒ¨é—¨
DELETE /api/departments/:id      # åˆ é™¤éƒ¨é—¨

// å“åº”æ ¼å¼è§„èŒƒ
interface ApiResponse<T> {
  success: boolean;
  data?: T;
  error?: string;
  message?: string;
  timestamp: string;
}
```

#### 3.2 ä¸­é—´ä»¶è§„èŒƒ
```typescript
// è®¤è¯ä¸­é—´ä»¶
export const authMiddleware = (req: Request, res: Response, next: NextFunction) => {
  // éªŒè¯JWT token
  // è®¾ç½®ç”¨æˆ·ä¿¡æ¯
  // æƒé™æ£€æŸ¥
};

// é”™è¯¯å¤„ç†ä¸­é—´ä»¶
export const errorHandler = (err: Error, req: Request, res: Response, next: NextFunction) => {
  // é”™è¯¯æ—¥å¿—è®°å½•
  // é”™è¯¯å“åº”æ ¼å¼åŒ–
  // é”™è¯¯ç›‘æ§ä¸ŠæŠ¥
};
```

## ğŸ” æœç´¢åŠŸèƒ½è§„èŒƒ

### 1. æœç´¢åŠŸèƒ½å¼‚å¸¸ä¿®å¤è§„èŒƒ

#### 1.1 é—®é¢˜è¯†åˆ«
- **ç°è±¡æè¿°**: ç³»ç»Ÿä»…èƒ½æ£€ç´¢åˆ°æŠ€æœ¯éƒ¨äººå‘˜
- **å½±å“èŒƒå›´**: å…¶ä»–éƒ¨é—¨ï¼ˆäººäº‹éƒ¨ã€äº§å“éƒ¨ã€è¿è¥éƒ¨ï¼‰äººå‘˜æ— æ³•è¢«æœç´¢
- **æ ¹æœ¬åŸå› **: ç´¢å¼•ä¸å®Œæ•´ï¼Œä»…æŠ€æœ¯éƒ¨æ•°æ®å»ºç«‹äº†æœ‰æ•ˆç´¢å¼•

#### 1.2 è§£å†³æ–¹æ¡ˆ
```sql
-- é‡å»ºå…¨é‡ç´¢å¼•
DROP INDEX IF EXISTS idx_employees_search;
CREATE INDEX idx_employees_search ON employees 
USING gin(to_tsvector('chinese', name || ' ' || department || ' ' || position));

-- éªŒè¯ç´¢å¼•è¦†ç›–
SELECT department, COUNT(*) as employee_count
FROM employees 
WHERE to_tsvector('chinese', name || ' ' || department || ' ' || position) @@ plainto_tsquery('chinese', 'æœç´¢è¯')
GROUP BY department;
```

#### 1.3 éªŒè¯æ ‡å‡†
- æ‰€æœ‰éƒ¨é—¨äººå‘˜å‡å¯è¢«æœç´¢åˆ°
- æœç´¢å“åº”æ—¶é—´ < 500ms
- æœç´¢ç»“æœå‡†ç¡®ç‡ > 95%

### 2. æ•°æ®åŒæ­¥é—®é¢˜å¤„ç†è§„èŒƒ

#### 2.1 å®æ—¶åŒæ­¥æœºåˆ¶
```typescript
// WebSocketæ•°æ®åŒæ­¥
class DataSyncService {
  private ws: WebSocket;
  
  // ç›‘å¬æ•°æ®å˜æ›´
  onDataChange(type: string, data: any) {
    this.broadcast({
      type: 'DATA_SYNC',
      payload: { type, data },
      timestamp: Date.now()
    });
  }
  
  // åŒæ­¥éªŒè¯
  async validateSync(): Promise<boolean> {
    const frontendData = await this.getFrontendData();
    const backendData = await this.getBackendData();
    return this.compareData(frontendData, backendData);
  }
}
```

#### 2.2 ç¼“å­˜ç®¡ç†è§„èŒƒ
```typescript
// ç¼“å­˜æ–‡ä»¶ç”Ÿæˆ
interface CacheConfig {
  source: 'sql' | 'api';
  ttl: number; // ç¼“å­˜æ—¶é—´ï¼ˆç§’ï¼‰
  refreshTrigger: 'time' | 'event' | 'manual';
}

// ç¦ç”¨è™šæ‹Ÿæ–‡ä»¶
const FORBIDDEN_DATA_SOURCES = [
  'mock-data.json',
  'virtual-employees.js',
  'fake-departments.ts'
];
```

## ğŸ–¥ï¸ M1æœåŠ¡å™¨å·¥ä½ç®¡ç†è§„èŒƒ

### 1. åŠŸèƒ½éœ€æ±‚è§„èŒƒ

#### 1.1 æ•°æ®å±•ç¤ºè¦æ±‚
```typescript
interface WorkstationDisplay {
  employeeName: string;      // å‘˜å·¥å§“å
  workstationId: string;     // å·¥ä½ç¼–å·
  coordinates: {             // åæ ‡ä¿¡æ¯
    x: number;
    y: number;
    floor: number;
  };
  status: 'occupied' | 'vacant' | 'maintenance'; // å·¥ä½çŠ¶æ€
  department: string;        // æ‰€å±éƒ¨é—¨
  lastUpdated: Date;        // æœ€åæ›´æ–°æ—¶é—´
}
```

#### 1.2 éƒ¨é—¨ç­›é€‰åŠŸèƒ½
```typescript
// ç®¡ç†å‘˜æƒé™éªŒè¯
const checkAdminPermission = (user: User): boolean => {
  return user.role === 'admin' || user.permissions.includes('MANAGE_WORKSTATIONS');
};

// å¤šæ¡ä»¶ç­›é€‰
interface FilterCriteria {
  department?: string[];
  status?: WorkstationStatus[];
  floor?: number[];
  dateRange?: {
    start: Date;
    end: Date;
  };
}
```

### 2. å®æ—¶æ›´æ–°è§„èŒƒ

#### 2.1 çŠ¶æ€æ›´æ–°æœºåˆ¶
```typescript
// å·¥ä½çŠ¶æ€æ›´æ–°
class WorkstationManager {
  async updateStatus(id: string, status: WorkstationStatus) {
    // 1. æ•°æ®åº“æ›´æ–°
    await this.database.updateWorkstation(id, { status });
    
    // 2. ç¼“å­˜æ›´æ–°
    await this.cache.invalidate(`workstation:${id}`);
    
    // 3. å®æ—¶é€šçŸ¥
    this.websocket.broadcast('WORKSTATION_UPDATE', { id, status });
    
    // 4. æ—¥å¿—è®°å½•
    this.logger.info(`Workstation ${id} status updated to ${status}`);
  }
}
```

## ğŸ“Š ç³»ç»Ÿæ ¡æ­£æ ‡å‡†

### 1. æ•°æ®æºç®¡ç†è§„èŒƒ

#### 1.1 å¼ºåˆ¶è¦æ±‚
- âœ… **å¿…é¡»ä½¿ç”¨**: SQLæŸ¥è¯¢ç”Ÿæˆçš„ç¼“å­˜æ–‡ä»¶
- âŒ **ç¦æ­¢ä½¿ç”¨**: è™šæ‹Ÿæ–‡ä»¶ä½œä¸ºæ•°æ®æº
- âœ… **ç¼“å­˜ç­–ç•¥**: é¡µé¢åˆæ¬¡åŠ è½½ä½¿ç”¨ç¼“å­˜æ–‡ä»¶
- âœ… **å®æ—¶æ›´æ–°**: æœç´¢æ“ä½œè§¦å‘æ–°çš„SQLæŸ¥è¯¢

#### 1.2 æ•°æ®æµè§„èŒƒ
```typescript
// æ•°æ®æµå‘
Database â†’ SQL Query â†’ Cache File â†’ Frontend Display
         â†“
    Real-time Sync â† WebSocket â† Data Change Event
```

### 2. æ€§èƒ½æ ‡å‡†

#### 2.1 å“åº”æ—¶é—´è¦æ±‚
- é¡µé¢åˆæ¬¡åŠ è½½: < 2ç§’
- æœç´¢å“åº”æ—¶é—´: < 500ms
- æ•°æ®åŒæ­¥å»¶è¿Ÿ: < 100ms
- APIå“åº”æ—¶é—´: < 300ms

#### 2.2 å¹¶å‘å¤„ç†èƒ½åŠ›
- åŒæ—¶åœ¨çº¿ç”¨æˆ·: > 100
- å¹¶å‘æœç´¢è¯·æ±‚: > 50
- WebSocketè¿æ¥æ•°: > 200

## ğŸ§ª æµ‹è¯•è§„èŒƒ

### 1. æµ‹è¯•è¦†ç›–ç‡è¦æ±‚
- å•å…ƒæµ‹è¯•è¦†ç›–ç‡: > 80%
- é›†æˆæµ‹è¯•è¦†ç›–ç‡: > 70%
- E2Eæµ‹è¯•è¦†ç›–ç‡: > 60%

### 2. æµ‹è¯•ç±»å‹è§„èŒƒ

#### 2.1 å•å…ƒæµ‹è¯•
```typescript
// ç»„ä»¶æµ‹è¯•
describe('DepartmentMappingManager', () => {
  it('should render employee list correctly', () => {
    // æµ‹è¯•ç»„ä»¶æ¸²æŸ“
  });
  
  it('should handle search functionality', () => {
    // æµ‹è¯•æœç´¢åŠŸèƒ½
  });
});

// APIæµ‹è¯•
describe('Department API', () => {
  it('should return all departments', async () => {
    // æµ‹è¯•APIå“åº”
  });
});
```

#### 2.2 é›†æˆæµ‹è¯•
```typescript
// æ•°æ®åº“é›†æˆæµ‹è¯•
describe('Database Integration', () => {
  it('should sync data between frontend and backend', async () => {
    // æµ‹è¯•æ•°æ®åŒæ­¥
  });
});
```

## ğŸ“ ä»£ç è´¨é‡æ ‡å‡†

### 1. ä»£ç è§„èŒƒ
- **TypeScript**: ä¸¥æ ¼æ¨¡å¼ï¼Œå®Œæ•´ç±»å‹å®šä¹‰
- **ESLint**: éµå¾ªé¡¹ç›®é…ç½®è§„åˆ™
- **Prettier**: ç»Ÿä¸€ä»£ç æ ¼å¼
- **æ³¨é‡Š**: å…³é”®é€»è¾‘å¿…é¡»æœ‰æ³¨é‡Š

### 2. æ€§èƒ½ä¼˜åŒ–
- **ç»„ä»¶å¤§å°**: å•ä¸ªç»„ä»¶ < 300è¡Œ
- **å‡½æ•°å¤æ‚åº¦**: åœˆå¤æ‚åº¦ < 10
- **åŒ…å¤§å°**: å•ä¸ªåŒ… < 100KB
- **å†…å­˜ä½¿ç”¨**: é¿å…å†…å­˜æ³„æ¼

### 3. å®‰å…¨è§„èŒƒ
- **è¾“å…¥éªŒè¯**: æ‰€æœ‰ç”¨æˆ·è¾“å…¥å¿…é¡»éªŒè¯
- **SQLæ³¨å…¥**: ä½¿ç”¨å‚æ•°åŒ–æŸ¥è¯¢
- **XSSé˜²æŠ¤**: è¾“å‡ºå†…å®¹è½¬ä¹‰
- **æƒé™æ§åˆ¶**: ä¸¥æ ¼çš„æƒé™éªŒè¯

## ğŸš€ éƒ¨ç½²è§„èŒƒ

### 1. ç¯å¢ƒé…ç½®
```bash
# å¼€å‘ç¯å¢ƒ
NODE_ENV=development
DATABASE_MODE=memory
LOG_LEVEL=debug

# æµ‹è¯•ç¯å¢ƒ
NODE_ENV=test
DATABASE_MODE=sqlite
LOG_LEVEL=info

# ç”Ÿäº§ç¯å¢ƒ
NODE_ENV=production
DATABASE_MODE=postgresql
LOG_LEVEL=error
```

### 2. éƒ¨ç½²æ£€æŸ¥æ¸…å•
- [ ] ç¯å¢ƒå˜é‡é…ç½®æ­£ç¡®
- [ ] æ•°æ®åº“è¿æ¥æµ‹è¯•é€šè¿‡
- [ ] æ‰€æœ‰æµ‹è¯•ç”¨ä¾‹é€šè¿‡
- [ ] æ€§èƒ½æŒ‡æ ‡è¾¾æ ‡
- [ ] å®‰å…¨æ‰«æé€šè¿‡
- [ ] æ–‡æ¡£æ›´æ–°å®Œæˆ

## ğŸ“‹ é—®é¢˜è·Ÿè¸ªè§„èŒƒ

### 1. é—®é¢˜åˆ†ç±»
- **P0**: ç³»ç»Ÿå´©æºƒï¼Œå½±å“æ‰€æœ‰ç”¨æˆ·
- **P1**: æ ¸å¿ƒåŠŸèƒ½å¼‚å¸¸ï¼Œå½±å“å¤§éƒ¨åˆ†ç”¨æˆ·
- **P2**: éƒ¨åˆ†åŠŸèƒ½å¼‚å¸¸ï¼Œå½±å“å°‘æ•°ç”¨æˆ·
- **P3**: ä¼˜åŒ–å»ºè®®ï¼Œä¸å½±å“æ­£å¸¸ä½¿ç”¨

### 2. é—®é¢˜å¤„ç†æµç¨‹
1. **é—®é¢˜æŠ¥å‘Š**: è¯¦ç»†æè¿°é—®é¢˜ç°è±¡
2. **é—®é¢˜åˆ†æ**: å®šä½æ ¹æœ¬åŸå› 
3. **è§£å†³æ–¹æ¡ˆ**: åˆ¶å®šä¿®å¤è®¡åˆ’
4. **æµ‹è¯•éªŒè¯**: ç¡®è®¤é—®é¢˜è§£å†³
5. **æ–‡æ¡£æ›´æ–°**: æ›´æ–°ç›¸å…³æ–‡æ¡£
6. **ç»éªŒæ€»ç»“**: é¿å…ç±»ä¼¼é—®é¢˜

## ğŸ“š å­¦ä¹ èµ„æº

### 1. æŠ€æœ¯æ–‡æ¡£
- [Reactå®˜æ–¹æ–‡æ¡£](https://react.dev/)
- [TypeScriptæ‰‹å†Œ](https://www.typescriptlang.org/docs/)
- [Node.jsæœ€ä½³å®è·µ](https://nodejs.org/en/docs/guides/)
- [PostgreSQLæ–‡æ¡£](https://www.postgresql.org/docs/)

### 2. å›¢é˜Ÿè§„èŒƒ
- [Gitå·¥ä½œæµç¨‹](docs/git-workflow.md)
- [ä»£ç å®¡æŸ¥æŒ‡å—](docs/code-review.md)
- [APIè®¾è®¡è§„èŒƒ](docs/api-design.md)
- [æ•°æ®åº“è®¾è®¡è§„èŒƒ](docs/database-design.md)

---

**æœ¬è§„èŒƒæ–‡æ¡£å°†éšç€é¡¹ç›®å‘å±•æŒç»­æ›´æ–°ï¼Œæ‰€æœ‰å›¢é˜Ÿæˆå‘˜éƒ½æœ‰è´£ä»»éµå¾ªå’Œå®Œå–„è¿™äº›è§„èŒƒã€‚**