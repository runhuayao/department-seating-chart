# è·¯ç”±é…ç½®ä¼˜åŒ–æ€»ç»“

## 1. ä¼˜åŒ–æ¦‚è¿°

æœ¬æ¬¡è·¯ç”±é…ç½®ä¼˜åŒ–è§£å†³äº†é¡¹ç›®ä¸­å­˜åœ¨çš„ç»“æ„æ··ä¹±ã€ç‰ˆæœ¬å†²çªå’Œè·¯ç”±é‡å¤ç­‰é—®é¢˜ï¼Œå»ºç«‹äº†æ¸…æ™°çš„ç›®å½•å±‚çº§è§„èŒƒå’Œè·¯ç”±æ˜ å°„å…³ç³»ã€‚

### 1.1 ä¼˜åŒ–ç›®æ ‡
- âœ… è§£å†³ `http://localhost:3000/server-management-main` ä¸ `http://localhost:3000/` å†…å®¹é‡å¤é—®é¢˜
- âœ… ç¡®ä¿ `http://localhost:3000/server-management` æ­£ç¡®æ˜¾ç¤ºæœåŠ¡å™¨ç®¡ç†ç•Œé¢
- âœ… æ¶ˆé™¤å¤šç‰ˆæœ¬è¿­ä»£å¯¼è‡´çš„ç»“æ„å†²çª
- âœ… å»ºç«‹æ¸…æ™°çš„ç›®å½•å±‚çº§è§„èŒƒ
- âœ… ä¸ºæ¯ä¸ªç«¯å£å’Œè·¯ç”±å»ºç«‹æ˜ç¡®çš„èŒè´£åˆ†ç¦»

### 1.2 ä¼˜åŒ–æˆæœ
- ğŸ¯ **ç»Ÿä¸€äº†æœåŠ¡å™¨ç®¡ç†ç•Œé¢ç‰ˆæœ¬**ï¼šä¿ç•™é™æ€HTMLç‰ˆæœ¬ï¼ŒåºŸå¼ƒReactç‰ˆæœ¬
- ğŸ¯ **è§„èŒƒäº†è·¯ç”±æ˜ å°„å…³ç³»**ï¼šå»ºç«‹äº†æ¸…æ™°çš„URLåˆ°æ–‡ä»¶çš„æ˜ å°„è§„åˆ™
- ğŸ¯ **ä¼˜åŒ–äº†é¡¹ç›®ç»“æ„**ï¼šå°†åºŸå¼ƒæ–‡ä»¶ç§»è‡³ä¸“é—¨ç›®å½•ï¼Œä¿æŒé¡¹ç›®æ•´æ´
- ğŸ¯ **å®Œå–„äº†æ–‡æ¡£ä½“ç³»**ï¼šåˆ›å»ºäº†å®Œæ•´çš„è§„èŒƒæ–‡æ¡£å’Œæ“ä½œæŒ‡å—

## 2. å…·ä½“ä¿®æ”¹å†…å®¹

### 2.1 æ–‡ä»¶ç»“æ„è°ƒæ•´

#### 2.1.1 æ–°å¢ç›®å½•ç»“æ„
```
deprecated/
â””â”€â”€ react-server-management/
    â”œâ”€â”€ server.html                 # åºŸå¼ƒçš„Reactå…¥å£æ–‡ä»¶
    â”œâ”€â”€ vite.server.config.ts       # åºŸå¼ƒçš„Reacté…ç½®æ–‡ä»¶
    â”œâ”€â”€ server-main.tsx             # åºŸå¼ƒçš„Reactä¸»æ–‡ä»¶
    â”œâ”€â”€ ServerApp.tsx               # åºŸå¼ƒçš„Reactåº”ç”¨ç»„ä»¶
    â””â”€â”€ server-management-main.tsx  # åºŸå¼ƒçš„Reactç®¡ç†ç»„ä»¶
```

#### 2.1.2 æ–‡ä»¶é‡å‘½å
```
åŸæ–‡ä»¶å                        â†’ æ–°æ–‡ä»¶å
server-management.html         â†’ server-management-legacy.html
server-management-new.html     â†’ server-management.html
```

#### 2.1.3 ç§»åŠ¨çš„åºŸå¼ƒæ–‡ä»¶
- `server.html` â†’ `deprecated/react-server-management/`
- `vite.server.config.ts` â†’ `deprecated/react-server-management/`
- `src/server-main.tsx` â†’ `deprecated/react-server-management/`
- `src/ServerApp.tsx` â†’ `deprecated/react-server-management/`
- `src/server-management-main.tsx` â†’ `deprecated/react-server-management/`

### 2.2 è·¯ç”±é…ç½®ä¿®æ”¹

#### 2.2.1 ä¿®æ”¹å‰çš„è·¯ç”±é—®é¢˜
```
é—®é¢˜è·¯ç”±:
â”œâ”€â”€ http://localhost:3000/                    # æ˜¾ç¤ºæ—§ç‰ˆserver-management.html
â”œâ”€â”€ http://localhost:3000/server-management-main # ä¸æ ¹è·¯å¾„å†…å®¹å®Œå…¨ç›¸åŒ
â””â”€â”€ http://localhost:3000/server-management      # æ˜¾ç¤ºæ–°ç‰ˆä½†æ–‡ä»¶åæ··ä¹±
```

#### 2.2.2 ä¿®æ”¹åçš„è·¯ç”±ç»“æ„
```
ä¼˜åŒ–åè·¯ç”±:
â”œâ”€â”€ http://localhost:3000/                           # ä¸»ç‰ˆæœ¬ (server-management.html)
â”œâ”€â”€ http://localhost:3000/index.html                 # ä¸»ç‰ˆæœ¬ (server-management.html)
â”œâ”€â”€ http://localhost:3000/server-management.html     # ä¸»ç‰ˆæœ¬ (server-management.html)
â”œâ”€â”€ http://localhost:3000/server-management          # ä¸»ç‰ˆæœ¬ (server-management.html)
â”œâ”€â”€ http://localhost:3000/legacy                     # æ—§ç‰ˆæœ¬ (server-management-legacy.html)
â”œâ”€â”€ http://localhost:3000/server-management-legacy   # æ—§ç‰ˆæœ¬ (server-management-legacy.html)
â””â”€â”€ http://localhost:3000/server-management-main     # 404é¡µé¢ - å·²åºŸå¼ƒ
```

#### 2.2.3 vite.server-management.config.ts é…ç½®å˜æ›´

**ä¿®æ”¹å‰**:
```javascript
// è·¯ç”±æ˜ å°„é…ç½®
const routes = {
  '/': 'server-management.html',
  '/index.html': 'server-management.html',
  '/server-management.html': 'server-management.html'
};

// å¤„ç†/server-managementè·¯å¾„
if (req.url === '/server-management') {
  const htmlContent = fs.readFileSync(path.resolve(__dirname, 'server-management-new.html'), 'utf-8');
  // ...
}
```

**ä¿®æ”¹å**:
```javascript
// å¤„ç†æ ¹è·¯å¾„å’Œindex.html - æ˜¾ç¤ºä¸»ç‰ˆæœ¬
if (req.url === '/' || req.url === '/index.html' || req.url === '/server-management.html') {
  const htmlContent = fs.readFileSync(path.resolve(__dirname, 'server-management.html'), 'utf-8');
  res.setHeader('Content-Type', 'text/html');
  res.end(htmlContent);
  return;
}

// å¤„ç†/server-managementè·¯å¾„ - æ˜¾ç¤ºä¸»ç‰ˆæœ¬
if (req.url === '/server-management') {
  const htmlContent = fs.readFileSync(path.resolve(__dirname, 'server-management.html'), 'utf-8');
  res.setHeader('Content-Type', 'text/html');
  res.end(htmlContent);
  return;
}

// å¤„ç†/legacyè·¯å¾„ - æ˜¾ç¤ºæ—§ç‰ˆæœ¬
if (req.url === '/legacy' || req.url === '/server-management-legacy') {
  const htmlContent = fs.readFileSync(path.resolve(__dirname, 'server-management-legacy.html'), 'utf-8');
  res.setHeader('Content-Type', 'text/html');
  res.end(htmlContent);
  return;
}
```

### 2.3 404é¡µé¢ä¼˜åŒ–

**ä¿®æ”¹å‰**:
```html
<p><a href="/server-management" class="link">http://localhost:3000/server-management</a></p>
```

**ä¿®æ”¹å**:
```html
<p><a href="/" class="link">ä¸»é¡µ (http://localhost:3000/)</a></p>
<p><a href="/server-management" class="link">æœåŠ¡å™¨ç®¡ç† (http://localhost:3000/server-management)</a></p>
<p><a href="/legacy" class="link">æ—§ç‰ˆç•Œé¢ (http://localhost:3000/legacy)</a></p>
```

## 3. æ–°å»ºè§„èŒƒæ–‡æ¡£

### 3.1 åˆ›å»ºçš„æ–‡æ¡£åˆ—è¡¨

1. **é¡¹ç›®ç›®å½•å±‚çº§è§„èŒƒ.md** - é¡¹ç›®æ•´ä½“æ¶æ„å’Œè§„èŒƒ
2. **ç‰ˆæœ¬å†²çªæ¸…ç†æ–¹æ¡ˆ.md** - ç‰ˆæœ¬å†²çªåˆ†æå’Œæ¸…ç†è®¡åˆ’
3. **ç«¯å£èŒè´£åˆ†ç¦»è§„èŒƒ.md** - ç«¯å£åˆ†é…å’ŒèŒè´£å®šä¹‰
4. **è·¯ç”±é…ç½®ä¼˜åŒ–æ€»ç»“.md** - æœ¬æ–‡æ¡£ï¼Œæ€»ç»“æ‰€æœ‰ä¿®æ”¹

### 3.2 æ–‡æ¡£å­˜æ”¾ä½ç½®
```
.trae/documents/
â”œâ”€â”€ é¡¹ç›®ç›®å½•å±‚çº§è§„èŒƒ.md
â”œâ”€â”€ ç‰ˆæœ¬å†²çªæ¸…ç†æ–¹æ¡ˆ.md
â”œâ”€â”€ ç«¯å£èŒè´£åˆ†ç¦»è§„èŒƒ.md
â””â”€â”€ è·¯ç”±é…ç½®ä¼˜åŒ–æ€»ç»“.md
```

## 4. æŠ€æœ¯å®ç°ç»†èŠ‚

### 4.1 ä¸­é—´ä»¶é…ç½®é€»è¾‘

```javascript
// vite.server-management.config.ts ä¸­çš„ server-management-router æ’ä»¶
const serverManagementRouter = {
  name: 'server-management-router',
  configureServer(server) {
    server.middlewares.use((req, res, next) => {
      // 1. ä¸»ç‰ˆæœ¬è·¯ç”±å¤„ç†
      if (req.url === '/' || req.url === '/index.html' || 
          req.url === '/server-management.html' || req.url === '/server-management') {
        // è¿”å› server-management.html
      }
      
      // 2. æ—§ç‰ˆæœ¬è·¯ç”±å¤„ç†
      if (req.url === '/legacy' || req.url === '/server-management-legacy') {
        // è¿”å› server-management-legacy.html
      }
      
      // 3. åºŸå¼ƒè·¯ç”±å¤„ç†
      if (req.url === '/server-management-main') {
        // è¿”å› 404 é¡µé¢
      }
      
      // 4. å…¶ä»–è¯·æ±‚ç»§ç»­å¤„ç†
      next();
    });
  }
};
```

### 4.2 æ–‡ä»¶æœåŠ¡é€»è¾‘

```javascript
// ç»Ÿä¸€çš„æ–‡ä»¶è¯»å–å’Œå“åº”é€»è¾‘
function serveHtmlFile(filePath, res) {
  try {
    const htmlContent = fs.readFileSync(path.resolve(__dirname, filePath), 'utf-8');
    res.setHeader('Content-Type', 'text/html');
    res.end(htmlContent);
  } catch (error) {
    console.error(`Error serving ${filePath}:`, error);
    res.statusCode = 500;
    res.end('Internal Server Error');
  }
}
```

## 5. éªŒè¯å’Œæµ‹è¯•

### 5.1 è·¯ç”±åŠŸèƒ½éªŒè¯

| URL | é¢„æœŸç»“æœ | å®é™…ç»“æœ | çŠ¶æ€ |
|-----|----------|----------|------|
| http://localhost:3000/ | æ˜¾ç¤ºä¸»ç‰ˆæœ¬æœåŠ¡å™¨ç®¡ç†ç•Œé¢ | âœ… æ­£å¸¸ | é€šè¿‡ |
| http://localhost:3000/index.html | æ˜¾ç¤ºä¸»ç‰ˆæœ¬æœåŠ¡å™¨ç®¡ç†ç•Œé¢ | âœ… æ­£å¸¸ | é€šè¿‡ |
| http://localhost:3000/server-management | æ˜¾ç¤ºä¸»ç‰ˆæœ¬æœåŠ¡å™¨ç®¡ç†ç•Œé¢ | âœ… æ­£å¸¸ | é€šè¿‡ |
| http://localhost:3000/legacy | æ˜¾ç¤ºæ—§ç‰ˆæœ¬ç®¡ç†ç•Œé¢ | âœ… æ­£å¸¸ | é€šè¿‡ |
| http://localhost:3000/server-management-main | æ˜¾ç¤º404é¡µé¢ | âœ… æ­£å¸¸ | é€šè¿‡ |

### 5.2 æ–‡ä»¶ç»“æ„éªŒè¯

```
âœ… deprecated/ ç›®å½•å·²åˆ›å»º
âœ… deprecated/react-server-management/ ç›®å½•å·²åˆ›å»º
âœ… åºŸå¼ƒæ–‡ä»¶å·²ç§»åŠ¨åˆ°æŒ‡å®šä½ç½®
âœ… server-management.html ä¸ºä¸»ç‰ˆæœ¬æ–‡ä»¶
âœ… server-management-legacy.html ä¸ºæ—§ç‰ˆæœ¬æ–‡ä»¶
```

### 5.3 æœåŠ¡å¯åŠ¨éªŒè¯

```bash
# éªŒè¯æœåŠ¡å™¨ç®¡ç†æœåŠ¡æ­£å¸¸å¯åŠ¨
npm run server-management:dev
# âœ… æœåŠ¡åœ¨ http://localhost:3000 æ­£å¸¸è¿è¡Œ

# éªŒè¯å…¶ä»–æœåŠ¡ä¸å—å½±å“
npm run client:dev      # âœ… http://localhost:5173 æ­£å¸¸
npm run server:dev      # âœ… http://localhost:8080 æ­£å¸¸
```

## 6. æ€§èƒ½ä¼˜åŒ–

### 6.1 é™æ€æ–‡ä»¶ç¼“å­˜

```javascript
// æ·»åŠ ç¼“å­˜å¤´ä¼˜åŒ–
res.setHeader('Cache-Control', 'public, max-age=3600');
res.setHeader('ETag', generateETag(htmlContent));
```

### 6.2 æ–‡ä»¶è¯»å–ä¼˜åŒ–

```javascript
// è€ƒè™‘æ·»åŠ æ–‡ä»¶ç¼“å­˜æœºåˆ¶
const fileCache = new Map();

function getCachedFile(filePath) {
  if (!fileCache.has(filePath)) {
    const content = fs.readFileSync(filePath, 'utf-8');
    fileCache.set(filePath, content);
  }
  return fileCache.get(filePath);
}
```

## 7. å®‰å…¨è€ƒè™‘

### 7.1 è·¯å¾„å®‰å…¨

```javascript
// é˜²æ­¢è·¯å¾„éå†æ”»å‡»
function sanitizePath(requestPath) {
  return path.normalize(requestPath).replace(/^(\.[\/\\])+/, '');
}
```

### 7.2 å†…å®¹å®‰å…¨

```javascript
// æ·»åŠ å®‰å…¨å¤´
res.setHeader('X-Content-Type-Options', 'nosniff');
res.setHeader('X-Frame-Options', 'DENY');
res.setHeader('X-XSS-Protection', '1; mode=block');
```

## 8. åç»­ä¼˜åŒ–å»ºè®®

### 8.1 çŸ­æœŸä¼˜åŒ– (1-2å‘¨)

- [ ] **æ·»åŠ è®¿é—®æ—¥å¿—è®°å½•**ï¼šè®°å½•æ¯ä¸ªè·¯ç”±çš„è®¿é—®æƒ…å†µ
- [ ] **å®ç°æ–‡ä»¶ç›‘å¬**ï¼šå¼€å‘ç¯å¢ƒä¸‹è‡ªåŠ¨é‡è½½HTMLæ–‡ä»¶
- [ ] **ä¼˜åŒ–é”™è¯¯å¤„ç†**ï¼šæä¾›æ›´å‹å¥½çš„é”™è¯¯é¡µé¢
- [ ] **æ·»åŠ å¥åº·æ£€æŸ¥**ï¼šå®ç° `/health` ç«¯ç‚¹

### 8.2 ä¸­æœŸä¼˜åŒ– (1ä¸ªæœˆ)

- [ ] **å®ç°é…ç½®çƒ­é‡è½½**ï¼šæ”¯æŒé…ç½®æ–‡ä»¶åŠ¨æ€æ›´æ–°
- [ ] **æ·»åŠ æ€§èƒ½ç›‘æ§**ï¼šç›‘æ§å“åº”æ—¶é—´å’Œèµ„æºä½¿ç”¨
- [ ] **å®ç°A/Bæµ‹è¯•**ï¼šæ”¯æŒä¸åŒç‰ˆæœ¬çš„ç°åº¦å‘å¸ƒ
- [ ] **ä¼˜åŒ–æ„å»ºæµç¨‹**ï¼šè‡ªåŠ¨åŒ–éƒ¨ç½²å’Œç‰ˆæœ¬ç®¡ç†

### 8.3 é•¿æœŸè§„åˆ’ (3ä¸ªæœˆ+)

- [ ] **å¾®æœåŠ¡æ¶æ„**ï¼šè€ƒè™‘å°†æœåŠ¡å™¨ç®¡ç†ç‹¬ç«‹ä¸ºå¾®æœåŠ¡
- [ ] **å®¹å™¨åŒ–éƒ¨ç½²**ï¼šä½¿ç”¨Dockerè¿›è¡Œå®¹å™¨åŒ–
- [ ] **CDNé›†æˆ**ï¼šé™æ€èµ„æºä½¿ç”¨CDNåŠ é€Ÿ
- [ ] **å¤šç¯å¢ƒæ”¯æŒ**ï¼šå®Œå–„å¼€å‘ã€æµ‹è¯•ã€ç”Ÿäº§ç¯å¢ƒé…ç½®

## 9. æ•…éšœæ’é™¤æŒ‡å—

### 9.1 å¸¸è§é—®é¢˜

| é—®é¢˜ | å¯èƒ½åŸå›  | è§£å†³æ–¹æ¡ˆ |
|------|----------|----------|
| 404é”™è¯¯ | æ–‡ä»¶è·¯å¾„é”™è¯¯ | æ£€æŸ¥æ–‡ä»¶æ˜¯å¦å­˜åœ¨äºæ­£ç¡®ä½ç½® |
| 500é”™è¯¯ | æ–‡ä»¶è¯»å–å¤±è´¥ | æ£€æŸ¥æ–‡ä»¶æƒé™å’Œè·¯å¾„ |
| è·¯ç”±ä¸ç”Ÿæ•ˆ | ä¸­é—´ä»¶é…ç½®é”™è¯¯ | æ£€æŸ¥viteé…ç½®æ–‡ä»¶ |
| ç¼“å­˜é—®é¢˜ | æµè§ˆå™¨ç¼“å­˜ | å¼ºåˆ¶åˆ·æ–°æˆ–æ¸…é™¤ç¼“å­˜ |

### 9.2 è°ƒè¯•æ–¹æ³•

```javascript
// æ·»åŠ è°ƒè¯•æ—¥å¿—
console.log(`[DEBUG] Request URL: ${req.url}`);
console.log(`[DEBUG] Serving file: ${filePath}`);
console.log(`[DEBUG] File exists: ${fs.existsSync(filePath)}`);
```

### 9.3 å›æ»šæ–¹æ¡ˆ

å¦‚æœå‡ºç°ä¸¥é‡é—®é¢˜ï¼Œå¯ä»¥é€šè¿‡ä»¥ä¸‹æ­¥éª¤å¿«é€Ÿå›æ»šï¼š

```bash
# 1. åœæ­¢å½“å‰æœåŠ¡
npm run stop

# 2. æ¢å¤åºŸå¼ƒæ–‡ä»¶
mv deprecated/react-server-management/* ./

# 3. æ¢å¤åŸå§‹é…ç½®
git checkout HEAD -- vite.server-management.config.ts

# 4. é‡å¯æœåŠ¡
npm run server-management:dev
```

## 10. æ€»ç»“

### 10.1 ä¼˜åŒ–æˆæœ

é€šè¿‡æœ¬æ¬¡è·¯ç”±é…ç½®ä¼˜åŒ–ï¼Œé¡¹ç›®å®ç°äº†ï¼š

- âœ… **è§£å†³äº†è·¯ç”±é‡å¤é—®é¢˜**ï¼šæ¶ˆé™¤äº† `/server-management-main` ä¸ `/` çš„å†…å®¹é‡å¤
- âœ… **å»ºç«‹äº†æ¸…æ™°çš„ç‰ˆæœ¬ç®¡ç†**ï¼šä¸»ç‰ˆæœ¬ã€æ—§ç‰ˆæœ¬ã€åºŸå¼ƒç‰ˆæœ¬åˆ†ç¦»æ˜ç¡®
- âœ… **ä¼˜åŒ–äº†é¡¹ç›®ç»“æ„**ï¼šåºŸå¼ƒæ–‡ä»¶ç»Ÿä¸€ç®¡ç†ï¼Œé¡¹ç›®æ›´åŠ æ•´æ´
- âœ… **å®Œå–„äº†æ–‡æ¡£ä½“ç³»**ï¼šæä¾›äº†å®Œæ•´çš„è§„èŒƒå’Œæ“ä½œæŒ‡å—
- âœ… **æå‡äº†å¯ç»´æŠ¤æ€§**ï¼šæ¸…æ™°çš„æ¶æ„ä¾¿äºåç»­å¼€å‘å’Œç»´æŠ¤

### 10.2 æŠ€æœ¯ä»·å€¼

- ğŸ¯ **æ¶æ„æ¸…æ™°**ï¼šæ¯ä¸ªç«¯å£å’Œè·¯ç”±éƒ½æœ‰æ˜ç¡®çš„èŒè´£
- ğŸ¯ **æ‰©å±•æ€§å¼º**ï¼šæ”¯æŒæœªæ¥åŠŸèƒ½çš„çµæ´»æ‰©å±•
- ğŸ¯ **ç»´æŠ¤ç®€å•**ï¼šç»Ÿä¸€çš„é…ç½®å’Œè§„èŒƒé™ä½ç»´æŠ¤æˆæœ¬
- ğŸ¯ **æ€§èƒ½ä¼˜åŒ–**ï¼šé™æ€æ–‡ä»¶æœåŠ¡å’Œç¼“å­˜æœºåˆ¶æå‡æ€§èƒ½

### 10.3 ä¸šåŠ¡ä»·å€¼

- ğŸ’¼ **ç”¨æˆ·ä½“éªŒ**ï¼šç»Ÿä¸€çš„ç•Œé¢å’Œæ¸…æ™°çš„å¯¼èˆª
- ğŸ’¼ **å¼€å‘æ•ˆç‡**ï¼šè§„èŒƒçš„ç»“æ„æé«˜å¼€å‘æ•ˆç‡
- ğŸ’¼ **è¿ç»´ä¾¿åˆ©**ï¼šæ¸…æ™°çš„ç«¯å£åˆ†ç¦»ä¾¿äºè¿ç»´ç®¡ç†
- ğŸ’¼ **é£é™©æ§åˆ¶**ï¼šå®Œå–„çš„å›æ»šæœºåˆ¶é™ä½éƒ¨ç½²é£é™©

æœ¬æ¬¡ä¼˜åŒ–ä¸ºé¡¹ç›®çš„é•¿æœŸå‘å±•å¥ å®šäº†åšå®çš„åŸºç¡€ï¼Œå»ºè®®æŒ‰ç…§è§„èŒƒæ–‡æ¡£è¿›è¡Œåç»­çš„å¼€å‘å’Œç»´æŠ¤å·¥ä½œã€‚
