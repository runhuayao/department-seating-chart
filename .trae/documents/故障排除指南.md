# 故障排除指南

## 1. 概述

本文档提供部门地图系统常见问题的诊断和解决方案，重点关注部门映射、搜索功能和系统集成相关问题。

## 2. 部门映射相关问题 🚨

### 2.1 搜索后提示"部门不存在"

**问题描述：**
用户在搜索栏输入员工姓名，系统显示匹配结果，但点击或回车后提示"部门不存在"，无法跳转到对应部门地图。

**根本原因：**
- 后端返回的部门名称为中文（如"工程部"）
- 前端路由配置使用英文标识符（如"Engineering"）
- 缺少中英文部门名称映射转换逻辑

**诊断步骤：**
1. 检查搜索API返回的数据格式
2. 确认前端部门配置中的标识符
3. 验证是否存在部门名称转换函数
4. 检查路由跳转逻辑中的部门参数

**解决方案：**
```javascript
// 1. 建立部门映射表
const DEPARTMENT_MAPPING = {
  '工程部': 'Engineering',
  '市场部': 'Marketing', 
  '销售部': 'Sales',
  '人事部': 'HR'
};

// 2. 添加转换函数
function convertDepartmentName(chineseName) {
  return DEPARTMENT_MAPPING[chineseName] || chineseName;
}

// 3. 在搜索结果处理中使用
const handleSearchResult = (employee) => {
  const englishDeptName = convertDepartmentName(employee.department);
  navigate(`/${englishDeptName}`);
};
```

**验证方法：**
- 搜索任意员工姓名
- 点击搜索结果
- 确认能正确跳转到对应部门地图
- 验证工位高亮功能正常

### 2.2 部门选择器显示异常

**问题描述：**
部门选择器中显示的部门名称与实际数据不匹配，或者选择后无法正确切换。

**解决方案：**
1. 检查部门数据源的一致性
2. 确保前后端使用相同的部门标识符
3. 验证部门选择器的数据绑定逻辑
4. 测试部门切换的路由跳转功能

## 3. 搜索功能问题

### 3.1 搜索无结果或结果不准确

**问题描述：**
输入已知存在的员工姓名，但搜索无结果或返回错误的员工信息。

**诊断步骤：**
1. 检查搜索API的请求参数
2. 验证后端数据库中的员工数据
3. 确认搜索算法的匹配逻辑
4. 检查前端搜索防抖设置

**解决方案：**
- 优化搜索算法，支持模糊匹配
- 检查数据库索引配置
- 调整搜索防抖延迟时间
- 添加搜索日志用于调试

### 3.2 搜索结果显示但无法点击

**问题描述：**
搜索结果正常显示，但点击后无响应或报错。

**解决方案：**
1. 检查搜索结果的事件绑定
2. 验证点击处理函数的逻辑
3. 确认搜索结果数据结构的完整性
4. 检查控制台错误信息

## 4. 地图显示问题

### 4.1 地图无法加载或显示空白

**问题描述：**
部门地图页面显示空白，或者地图组件加载失败。

**诊断步骤：**
1. 检查地图数据API的响应
2. 验证SVG地图文件的完整性
3. 确认地图组件的渲染逻辑
4. 检查浏览器控制台错误

**解决方案：**
- 验证地图数据的JSON格式
- 检查SVG文件路径和权限
- 添加地图加载状态提示
- 实现地图加载失败的重试机制

### 4.2 工位状态显示错误

**问题描述：**
工位颜色状态与实际员工在岗情况不符。

**解决方案：**
1. 检查员工状态数据的更新频率
2. 验证工位状态计算逻辑
3. 确认颜色映射规则的正确性
4. 实现状态数据的实时同步

## 5. 认证和权限问题

### 5.1 登录后无法访问功能

**问题描述：**
用户成功登录，但无法使用搜索或查看地图等功能。

**解决方案：**
1. 检查JWT token的有效性
2. 验证用户权限配置
3. 确认API请求的认证头设置
4. 检查后端权限验证逻辑

### 5.2 会话超时处理

**问题描述：**
用户会话超时后，系统没有正确处理或提示。

**解决方案：**
- 实现token自动刷新机制
- 添加会话超时提示
- 优化登录状态检查逻辑
- 提供便捷的重新登录流程

## 6. 性能优化问题

### 6.1 页面加载缓慢

**问题描述：**
地图页面或搜索功能响应缓慢，影响用户体验。

**解决方案：**
1. 优化地图数据的加载策略
2. 实现搜索结果的分页或虚拟滚动
3. 添加适当的缓存机制
4. 压缩和优化静态资源

### 6.2 内存占用过高

**问题描述：**
长时间使用后，浏览器内存占用持续增长。

**解决方案：**
- 检查事件监听器的清理
- 优化组件的生命周期管理
- 实现适当的数据清理机制
- 使用性能分析工具定位问题

## 7. 数据同步问题

### 7.1 员工信息更新不及时

**问题描述：**
员工调岗或离职后，地图上的信息没有及时更新。

**解决方案：**
1. 检查数据同步的触发机制
2. 优化数据更新的频率设置
3. 实现增量数据更新
4. 添加手动刷新功能

## 8. 紧急处理流程

### 8.1 系统完全无法访问

**处理步骤：**
1. 检查服务器状态和网络连接
2. 验证数据库连接和服务状态
3. 查看系统日志和错误信息
4. 联系系统管理员进行紧急修复
5. 启动备用系统（如果可用）

### 8.2 数据丢失或损坏

**处理步骤：**
1. 立即停止相关操作
2. 评估数据损坏的范围
3. 从最近的备份恢复数据
4. 验证数据完整性
5. 通知相关用户和管理层

## 9. 预防措施

### 9.1 定期检查清单

**每日检查：**
- [ ] 搜索功能是否正常
- [ ] 部门跳转是否正确
- [ ] 地图加载是否正常
- [ ] 用户认证是否有效

**每周检查：**
- [ ] 数据同步是否及时
- [ ] 系统性能是否正常
- [ ] 错误日志是否有异常
- [ ] 备份机制是否正常

**每月检查：**
- [ ] 功能完整性验证
- [ ] 安全漏洞扫描
- [ ] 性能基准测试
- [ ] 文档更新状态

### 9.2 监控和告警

**关键指标监控：**
- API响应时间
- 错误率统计
- 用户活跃度
- 系统资源使用率

**告警设置：**
- 搜索功能异常告警
- 部门映射错误告警
- 系统性能下降告警
- 数据同步失败告警

---

**注意：** 遇到本文档未涵盖的问题时，请及时记录问题详情并更新本指南，确保知识库的完整性。