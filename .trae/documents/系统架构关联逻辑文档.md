# ç³»ç»Ÿæ¶æ„å…³è”é€»è¾‘æ–‡æ¡£

## 1. æ¶æ„æ¦‚è§ˆ

æœ¬é¡¹ç›®é‡‡ç”¨**å¾®å‰ç«¯æ¶æ„**ï¼Œç”±ä¸¤ä¸ªç‹¬ç«‹å‰ç«¯ç³»ç»Ÿå’Œä¸€ä¸ªç»Ÿä¸€åç«¯æœåŠ¡ç»„æˆï¼š

| ç³»ç»Ÿ      | ç«¯å£   | èŒè´£             | å…¥å£æ–‡ä»¶                                                          | é¡µé¢å†…å®¹é™åˆ¶      |
| ------- | ---- | -------------- | ------------------------------------------------------------- | ----------- |
| éƒ¨é—¨åœ°å›¾ç³»ç»Ÿ  | 5173 | åœ°å›¾å±•ç¤ºã€äººå‘˜æœç´¢ã€å·¥ä½ç®¡ç† | `src/main.tsx` â†’ `App.tsx`                                    | å®Œæ•´åŠŸèƒ½é¡µé¢      |
| æœåŠ¡å™¨ç®¡ç†ç³»ç»Ÿ | 3000 | æœåŠ¡å™¨ç›‘æ§ã€ç³»ç»Ÿç®¡ç†     | `src/server-management-main.tsx` â†’ `ServerManagementRoot.tsx` | å®Œæ•´M1æœåŠ¡å™¨ç®¡ç†é¡µé¢ |
| åç«¯APIæœåŠ¡ | 8080 | æ•°æ®æ¥å£ã€ä¸šåŠ¡é€»è¾‘      | `api/server.ts`                                               | ä»…APIè°ƒç”¨ç›‘æ§ç•Œé¢  |

## 2. ç³»ç»Ÿæ¶æ„å›¾

```mermaid
graph TB
    subgraph "å‰ç«¯å±‚"
        A["éƒ¨é—¨åœ°å›¾ç³»ç»Ÿ<br/>:5173<br/>å®Œæ•´åŠŸèƒ½é¡µé¢"]
        B["æœåŠ¡å™¨ç®¡ç†ç³»ç»Ÿ<br/>:3000<br/>M1æœåŠ¡å™¨ç®¡ç†é¡µé¢"]
    end
    
    subgraph "æœåŠ¡å±‚"
        C["APIæœåŠ¡<br/>:8080<br/>ä»…APIç›‘æ§ç•Œé¢"]
        D["WebSocketæœåŠ¡<br/>server-monitor.ts"]
        E["è¿æ¥ç®¡ç†å™¨<br/>ConnectionManager"]
        F["æ¶ˆæ¯å¹¿æ’­å™¨<br/>MessageBroadcaster"]
    end
    
    subgraph "æ•°æ®è®¿é—®å±‚"
        G["PostgreSQLè¿æ¥æ± <br/>Pool Manager"]
        H["æŸ¥è¯¢æ‰§è¡Œå™¨<br/>QueryExecutor"]
        I["äº‹åŠ¡ç®¡ç†å™¨<br/>TransactionManager"]
    end
    
    subgraph "æ•°æ®å­˜å‚¨å±‚"
        J[("PostgreSQL<br/>ä¸»æ•°æ®åº“")]
        K[("Redis<br/>ç¼“å­˜/ä¼šè¯")]
    end
    
    A -->|HTTP/API| C
    B -->|HTTP/API| C
    B -->|WebSocketè¿æ¥| D
    D --> E
    D --> F
    E -->|å¤šè¿æ¥ç®¡ç†| G
    F -->|å®æ—¶æ¨é€| B
    G --> H
    G --> I
    H -->|æ•°æ®æŸ¥è¯¢| J
    I -->|äº‹åŠ¡å¤„ç†| J
    C -->|ç¼“å­˜æ“ä½œ| K
    D -->|ä¼šè¯ç®¡ç†| K
    
    %% WebSocketè¿æ¥å…³ç³»
    D -.->|NOTIFY/LISTEN| J
    E -.->|è¿æ¥æ± ç›‘æ§| G
    F -.->|å¹¿æ’­æ¶ˆæ¯| D
```

## 3. ç«¯å£é…ç½®ä¸èŒè´£åˆ†å·¥

### 3.1 ç«¯å£èŒè´£æ˜ç¡®åˆ’åˆ†

**8080ç«¯å£ - APIæœåŠ¡å±‚**

* **èŒè´£é™åˆ¶**ï¼šä»…æä¾›APIè°ƒç”¨æƒ…å†µçš„ç›‘æ§å¯è§†åŒ–ç•Œé¢

* **ç¦æ­¢å†…å®¹**ï¼šä¸å¾—æ˜¾ç¤ºM1æœåŠ¡å™¨ç®¡ç†ç›¸å…³å†…å®¹

* **ç›‘æ§èŒƒå›´**ï¼šAPIè¯·æ±‚ç»Ÿè®¡ã€å“åº”æ—¶é—´ã€é”™è¯¯ç‡ã€æ¥å£è°ƒç”¨é¢‘æ¬¡

* **ç•Œé¢ç‰¹å¾**ï¼šè½»é‡çº§ç›‘æ§ä»ªè¡¨æ¿ï¼Œä¸“æ³¨äºAPIæ€§èƒ½æŒ‡æ ‡

**3000ç«¯å£ - æœåŠ¡å™¨ç®¡ç†ç³»ç»Ÿ**

* **å®Œæ•´åŠŸèƒ½**ï¼šä¿ç•™åŸ8080ç«¯å£çš„æ‰€æœ‰M1æœåŠ¡å™¨ç®¡ç†é¡µé¢å†…å®¹

* **ç®¡ç†èŒƒå›´**ï¼šæœåŠ¡å™¨ç›‘æ§ã€ç³»ç»Ÿç®¡ç†ã€ç”¨æˆ·ç®¡ç†ã€å®‰å…¨ç®¡ç†ç­‰

* **ç•Œé¢ç‰¹å¾**ï¼šå®Œæ•´çš„M1æœåŠ¡å™¨ç®¡ç†ä»ªè¡¨æ¿å’Œæ§åˆ¶é¢æ¿

**é…ç½®é”™è¯¯ä¿®æ­£**

* **é—®é¢˜**ï¼š3030ç«¯å£é”™è¯¯åŠ è½½äº†5173ç«¯å£å†…å®¹è€ŒéM1æœåŠ¡å™¨ç®¡ç†é¡µé¢

* **è§£å†³æ–¹æ¡ˆ**ï¼šä¿®æ­£é»˜è®¤æ ¹é¡µé¢è·¯ç”±é…ç½®ï¼Œç¡®ä¿3030ç«¯å£æ­£ç¡®æŒ‡å‘æœåŠ¡å™¨ç®¡ç†ç³»ç»Ÿ

* **è·¯ç”±é…ç½®**ï¼š`vite.server-management.config.ts`ä¸­çš„ç«¯å£å’Œè·¯ç”±æ˜ å°„éœ€è¦å‡†ç¡®é…ç½®

### 3.2 ç‹¬ç«‹éƒ¨ç½²æ¶æ„

**æŠ€æœ¯å®ç°ï¼š**

* **å…¥å£éš”ç¦»**ï¼šå„ç³»ç»Ÿä½¿ç”¨ç‹¬ç«‹çš„HTMLå…¥å£å’ŒTypeScriptä¸»æ–‡ä»¶

* **é…ç½®åˆ†ç¦»**ï¼šé€šè¿‡ä¸åŒçš„Viteé…ç½®æ–‡ä»¶å®ç°ç«¯å£å’Œæ„å»ºéš”ç¦»

* **èµ„æºç‹¬ç«‹**ï¼šå„ç³»ç»Ÿæ‹¥æœ‰ç‹¬ç«‹çš„ä¾èµ–ç®¡ç†å’Œèµ„æºåŠ è½½ç­–ç•¥

**æ¶æ„ä¼˜åŠ¿ï¼š**

* âœ… **æ¨¡å—åŒ–å¼€å‘**ï¼šå›¢é˜Ÿå¯å¹¶è¡Œå¼€å‘ï¼Œé™ä½åä½œå¤æ‚åº¦

* âœ… **ç‹¬ç«‹éƒ¨ç½²**ï¼šæ”¯æŒä¸åŒå‘å¸ƒå‘¨æœŸå’Œç°åº¦ç­–ç•¥

* âœ… **æ•…éšœéš”ç¦»**ï¼šå•ç³»ç»Ÿæ•…éšœä¸å½±å“å…¶ä»–ç³»ç»Ÿè¿è¡Œ

* âœ… **æ€§èƒ½ä¼˜åŒ–**ï¼šæŒ‰éœ€åŠ è½½ï¼Œå‡å°‘åˆå§‹åŒ…ä½“ç§¯

### 3.2 ç»Ÿä¸€æ•°æ®æœåŠ¡

ä¸¤ä¸ªå‰ç«¯ç³»ç»Ÿé€šè¿‡ç»Ÿä¸€çš„APIæœåŠ¡è¿›è¡Œæ•°æ®äº¤äº’ï¼Œç¡®ä¿ï¼š

* **æ•°æ®ä¸€è‡´æ€§**ï¼šç»Ÿä¸€çš„æ•°æ®æ¨¡å‹å’Œä¸šåŠ¡é€»è¾‘

* **æƒé™æ§åˆ¶**ï¼šé›†ä¸­çš„è®¤è¯å’Œæˆæƒç®¡ç†

* **æ¥å£æ ‡å‡†åŒ–**ï¼šä¸€è‡´çš„è¯·æ±‚/å“åº”æ ¼å¼

## 4. ç³»ç»Ÿè¯¦ç»†è¯´æ˜

### 4.1 éƒ¨é—¨åœ°å›¾ç³»ç»Ÿ (5173ç«¯å£)

**æ ¸å¿ƒåŠŸèƒ½ï¼š**

```typescript
// ä¸»è¦ç»„ä»¶ç»“æ„
src/
â”œâ”€â”€ main.tsx              // åº”ç”¨å…¥å£
â”œâ”€â”€ App.tsx               // ä¸»åº”ç”¨ç»„ä»¶
â”œâ”€â”€ components/
â”‚   â”œâ”€â”€ DeptMap.tsx       // åœ°å›¾æ¸²æŸ“
â”‚   â””â”€â”€ LoginForm.tsx     // ç”¨æˆ·è®¤è¯
â””â”€â”€ contexts/
    â””â”€â”€ AuthContext.tsx   // è®¤è¯çŠ¶æ€ç®¡ç†
```

**æ•°æ®æµç¨‹ï¼š**

1. **è®¤è¯æµç¨‹**ï¼š`LoginForm` â†’ `AuthContext` â†’ `localStorage(token)` â†’ `API Headers`
2. **åœ°å›¾æ¸²æŸ“**ï¼š`departmentData.ts` â†’ `DeptMap.tsx` â†’ `SVGæ¸²æŸ“`
3. **æœç´¢åŠŸèƒ½**ï¼š`è¾“å…¥é˜²æŠ–(300ms)` â†’ `APIè°ƒç”¨` â†’ `ç»“æœå±•ç¤º` â†’ `åœ°å›¾å®šä½`

**å…³é”®é…ç½®ï¼š**

```typescript
// vite.config.ts
export default defineConfig({
  server: {
    port: 5173,
    proxy: {
      '/api': {
        target: 'http://localhost:8080',
        changeOrigin: true
      }
    }
  }
})
```

### 4.2 æœåŠ¡å™¨ç®¡ç†ç³»ç»Ÿ (3000ç«¯å£)

**æ ¸å¿ƒåŠŸèƒ½æ¨¡å—è¯¦ç»†è¯´æ˜ï¼š**

```typescript
// ServerManagementRoot.tsx ä¸»è¦æ¨¡å—ç»“æ„
ServerManagementRoot.tsx
â”œâ”€â”€ ä»ªè¡¨æ¿ (Dashboard)     // ç³»ç»Ÿæ¦‚è§ˆ + PostgreSQLå…³é”®æŒ‡æ ‡
â”œâ”€â”€ æœåŠ¡å™¨ç›‘æ§ (Monitoring) // ç®€åŒ–ç‰ˆAPIè°ƒç”¨ç»Ÿè®¡ + è·³è½¬8080è¯¦æƒ…
â”œâ”€â”€ ç”¨æˆ·ç®¡ç† (Users)       // PostgreSQLç”¨æˆ·æ•°æ®ç®¡ç†ï¼ˆåŸå·¥ä½ç®¡ç†ï¼‰
â”œâ”€â”€ å®‰å…¨ç®¡ç† (Security)    // å®‰å…¨ç­–ç•¥ + PostgreSQLè®¿é—®æ§åˆ¶
â””â”€â”€ ç³»ç»Ÿè®¾ç½® (Settings)    // é…ç½®ç®¡ç† + PostgreSQLè¿æ¥é…ç½®
```

#### 4.2.1 ä»ªè¡¨æ¿ (Dashboard)

**åŠŸèƒ½èŒè´£ï¼š**

* æ˜¾ç¤ºç³»ç»Ÿæ¦‚è§ˆä¿¡æ¯å’Œè¿è¡ŒçŠ¶æ€

* é›†æˆPostgreSQLå…³é”®æŒ‡æ ‡å¯è§†åŒ–

  * æ•°æ®åº“è¿æ¥æ•°ã€æŸ¥è¯¢æ€§èƒ½ã€å­˜å‚¨ä½¿ç”¨ç‡

  * å®æ—¶äº‹åŠ¡ç»Ÿè®¡ã€é”ç­‰å¾…æƒ…å†µ

  * æ•°æ®åº“å¥åº·çŠ¶æ€ç›‘æ§

```typescript
// PostgreSQLæŒ‡æ ‡é›†æˆ
const [dbMetrics, setDbMetrics] = useState({
  connections: 0,
  queryPerformance: 0,
  storageUsage: 0,
  transactionCount: 0,
  lockWaits: 0
});

useEffect(() => {
  const fetchDbMetrics = async () => {
    const response = await fetch('/api/database/metrics');
    const metrics = await response.json();
    setDbMetrics(metrics);
  };
  
  const interval = setInterval(fetchDbMetrics, 5000);
  return () => clearInterval(interval);
}, []);
```

#### 4.2.2 æœåŠ¡å™¨ç›‘æ§ (Monitoring)

**åŠŸèƒ½èŒè´£ï¼š**

* å®æ—¶æ˜¾ç¤ºAPIæœåŠ¡è°ƒç”¨æ¬¡æ•°ï¼ˆç®€åŒ–ç‰ˆç»Ÿè®¡ï¼‰

* æä¾›"æŸ¥çœ‹è¯¦æƒ…"æŒ‰é’®è·³è½¬è‡³8080ç«¯å£è·å–å®Œæ•´ç›‘æ§æ•°æ®

* æ˜¾ç¤ºå…³é”®æ€§èƒ½æŒ‡æ ‡æ¦‚è§ˆ

```typescript
// ç®€åŒ–ç‰ˆAPIç›‘æ§
const ApiMonitoringSummary = () => {
  const [apiStats, setApiStats] = useState({
    totalCalls: 0,
    successRate: 0,
    avgResponseTime: 0,
    errorCount: 0
  });

  const handleViewDetails = () => {
    window.open('http://localhost:8080', '_blank');
  };

  return (
    <div className="api-monitoring-summary">
      <div className="stats-grid">
        <div className="stat-item">
          <span>æ€»è°ƒç”¨æ¬¡æ•°</span>
          <span>{apiStats.totalCalls}</span>
        </div>
        <div className="stat-item">
          <span>æˆåŠŸç‡</span>
          <span>{apiStats.successRate}%</span>
        </div>
      </div>
      <button onClick={handleViewDetails} className="details-btn">
        æŸ¥çœ‹å®Œæ•´ç›‘æ§æ•°æ®
      </button>
    </div>
  );
};
```

#### 4.2.3 ç”¨æˆ·ç®¡ç† (Users)

**åŠŸèƒ½èŒè´£ï¼š**

* ç®¡ç†PostgreSQLç”¨æˆ·æ•°æ®ï¼ˆæ•´åˆåŸå·¥ä½ç®¡ç†åŠŸèƒ½ï¼‰

* æ”¯æŒæ•°æ®ä¿®æ”¹å¹¶å®æ—¶ä¿å­˜è‡³PostgreSQL

* æ•°æ®å˜æ›´åè‡ªåŠ¨åŒæ­¥æ›´æ–°å‰ç«¯5173ç«¯å£æ˜¾ç¤º

```typescript
// ç”¨æˆ·æ•°æ®ç®¡ç†ï¼ˆåŸå·¥ä½ç®¡ç†åŠŸèƒ½ï¼‰
const UserManagement = () => {
  const [users, setUsers] = useState([]);
  const [workstations, setWorkstations] = useState([]);

  const handleUserUpdate = async (userId, userData) => {
    try {
      // æ›´æ–°PostgreSQLæ•°æ®
      await fetch(`/api/users/${userId}`, {
        method: 'PUT',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify(userData)
      });
      
      // è§¦å‘Redisç¼“å­˜æ›´æ–°
      await fetch('/api/cache/invalidate/users');
      
      // é€šçŸ¥å‰ç«¯5173ç«¯å£åŒæ­¥æ›´æ–°
      broadcastUpdate('user_updated', { userId, userData });
      
      setUsers(prev => prev.map(user => 
        user.id === userId ? { ...user, ...userData } : user
      ));
    } catch (error) {
      console.error('ç”¨æˆ·æ•°æ®æ›´æ–°å¤±è´¥:', error);
    }
  };

  return (
    <div className="user-management">
      <UserTable 
        users={users} 
        workstations={workstations}
        onUserUpdate={handleUserUpdate}
      />
    </div>
  );
};
```

#### 4.2.4 å®‰å…¨ç®¡ç† (Security)

**åŠŸèƒ½èŒè´£ï¼š**

* é…ç½®ç³»ç»Ÿå®‰å…¨ç­–ç•¥å’Œè®¿é—®æ§åˆ¶

* é›†æˆPostgreSQLè®¿é—®æ§åˆ¶ç®¡ç†

* ç®¡ç†æ•°æ®åº“ç”¨æˆ·æƒé™å’Œè§’è‰²

```typescript
// PostgreSQLè®¿é—®æ§åˆ¶ç®¡ç†
const SecurityManagement = () => {
  const [dbUsers, setDbUsers] = useState([]);
  const [permissions, setPermissions] = useState([]);

  const updateDbPermissions = async (userId, newPermissions) => {
    try {
      await fetch('/api/database/permissions', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ userId, permissions: newPermissions })
      });
      
      setPermissions(prev => ({ ...prev, [userId]: newPermissions }));
    } catch (error) {
      console.error('æƒé™æ›´æ–°å¤±è´¥:', error);
    }
  };

  return (
    <div className="security-management">
      <DatabaseUserPermissions 
        users={dbUsers}
        permissions={permissions}
        onPermissionUpdate={updateDbPermissions}
      />
    </div>
  );
};
```

#### 4.2.5 ç³»ç»Ÿè®¾ç½® (Settings)

**åŠŸèƒ½èŒè´£ï¼š**

* ç®¡ç†ç³»ç»Ÿé…ç½®å‚æ•°å’Œè¿è¡Œç¯å¢ƒ

* æ”¯æŒPostgreSQLè¿æ¥é…ç½®è°ƒæ•´

* å®æ—¶æµ‹è¯•æ•°æ®åº“è¿æ¥çŠ¶æ€

```typescript
// PostgreSQLè¿æ¥é…ç½®ç®¡ç†
const SystemSettings = () => {
  const [dbConfig, setDbConfig] = useState({
    host: 'localhost',
    port: 5432,
    database: 'department_map',
    maxConnections: 20,
    connectionTimeout: 5000
  });

  const testConnection = async () => {
    try {
      const response = await fetch('/api/database/test-connection', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify(dbConfig)
      });
      
      const result = await response.json();
      return result.success;
    } catch (error) {
      console.error('è¿æ¥æµ‹è¯•å¤±è´¥:', error);
      return false;
    }
  };

  const saveDbConfig = async () => {
    const isConnected = await testConnection();
    if (isConnected) {
      await fetch('/api/database/config', {
        method: 'PUT',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify(dbConfig)
      });
    }
  };

  return (
    <div className="system-settings">
      <DatabaseConfigForm 
        config={dbConfig}
        onConfigChange={setDbConfig}
        onSave={saveDbConfig}
        onTest={testConnection}
      />
    </div>
  );
};
```

**å®æ—¶ç›‘æ§å®ç°ï¼š**

```typescript
// æ€§èƒ½æ•°æ®æ›´æ–°
useEffect(() => {
  const interval = setInterval(() => {
    setServerStatus(prev => ({
      ...prev,
      cpu: updateMetric(prev.cpu, 10),
      memory: updateMetric(prev.memory, 8)
    }));
  }, 3000);
  return () => clearInterval(interval);
}, []);
```

### 4.3 åç«¯APIæœåŠ¡ (8080ç«¯å£)

**æ ¸å¿ƒåŠŸèƒ½ï¼š**

* æä¾›RESTful APIæ¥å£

* å¤„ç†æ•°æ®åº“æ“ä½œå’Œä¸šåŠ¡é€»è¾‘

* å®ç°WebSocketå®æ—¶é€šä¿¡

* é›†æˆRedisç¼“å­˜ä¼˜åŒ–

**ç»„ä»¶ç»“æ„ï¼š**

```typescript
// APIæœåŠ¡æ¶æ„
api/
â”œâ”€â”€ routes/           // è·¯ç”±å®šä¹‰
â”‚   â”œâ”€â”€ auth.ts      // è®¤è¯ç›¸å…³
â”‚   â”œâ”€â”€ users.ts     // ç”¨æˆ·ç®¡ç†
â”‚   â””â”€â”€ search.ts    // æœç´¢åŠŸèƒ½
â”œâ”€â”€ middleware/       // ä¸­é—´ä»¶
â”‚   â”œâ”€â”€ auth.ts      // è®¤è¯ä¸­é—´ä»¶
â”‚   â””â”€â”€ cors.ts      // è·¨åŸŸå¤„ç†
â”œâ”€â”€ services/         // ä¸šåŠ¡é€»è¾‘
â”‚   â”œâ”€â”€ database.ts  // æ•°æ®åº“æœåŠ¡
â”‚   â””â”€â”€ cache.ts     // ç¼“å­˜æœåŠ¡
â””â”€â”€ websocket/        // WebSocketæœåŠ¡
    â””â”€â”€ server-monitor.ts
```

### 4.4 RedisæœåŠ¡èŒè´£è¯¦è§£

**RedisæœåŠ¡çš„äº”å¤§æ ¸å¿ƒèŒè´£ï¼š**

#### 4.4.1 ä¸­é—´ç¼“å­˜å±‚

**èŒè´£æè¿°ï¼š**

* ä½œä¸ºPostgreSQLä¸å‰ç«¯ä¹‹é—´çš„é«˜é€Ÿç¼“å­˜å±‚

* ç¼“å­˜é¢‘ç¹æŸ¥è¯¢çš„æ•°æ®ï¼Œå‡å°‘æ•°æ®åº“å‹åŠ›

* æä¾›æ¯«ç§’çº§æ•°æ®è®¿é—®é€Ÿåº¦

```typescript
// Redisç¼“å­˜å±‚å®ç°
class RedisCacheService {
  private redis: Redis;

  async get(key: string): Promise<any> {
    const cached = await this.redis.get(key);
    return cached ? JSON.parse(cached) : null;
  }

  async set(key: string, value: any, ttl: number = 3600): Promise<void> {
    await this.redis.setex(key, ttl, JSON.stringify(value));
  }

  async invalidate(pattern: string): Promise<void> {
    const keys = await this.redis.keys(pattern);
    if (keys.length > 0) {
      await this.redis.del(...keys);
    }
  }
}
```

#### 4.4.2 ç›‘å¬PostgreSQLå˜æ›´äº‹ä»¶

**èŒè´£æè¿°ï¼š**

* ç›‘å¬æ•°æ®åº“è§¦å‘å™¨äº§ç”Ÿçš„å˜æ›´é€šçŸ¥

* å®æ—¶æ•è·æ•°æ®å¢åˆ æ”¹æ“ä½œ

* è§¦å‘ç›¸åº”çš„ç¼“å­˜æ›´æ–°å’Œé€šçŸ¥æœºåˆ¶

```typescript
// PostgreSQLå˜æ›´ç›‘å¬
class DatabaseChangeListener {
  private redis: Redis;
  private pgClient: Client;

  async startListening(): Promise<void> {
    // ç›‘å¬PostgreSQL NOTIFYäº‹ä»¶
    await this.pgClient.query('LISTEN user_changes');
    await this.pgClient.query('LISTEN workstation_changes');

    this.pgClient.on('notification', async (msg) => {
      const { channel, payload } = msg;
      const changeData = JSON.parse(payload);
      
      // å‘å¸ƒå˜æ›´äº‹ä»¶åˆ°Redis
      await this.redis.publish(`db_change:${channel}`, JSON.stringify({
        timestamp: Date.now(),
        operation: changeData.operation,
        table: changeData.table,
        data: changeData.data
      }));
    });
  }
}
```

#### 4.4.3 æ¨é€æ›´æ–°é€šçŸ¥è‡³å‰ç«¯

**èŒè´£æè¿°ï¼š**

* é€šè¿‡Redis Pub/Subæœºåˆ¶æ¨é€å®æ—¶æ›´æ–°

* å‘5173ç«¯å£å‰ç«¯å‘é€æ•°æ®å˜æ›´é€šçŸ¥

* æ”¯æŒå¤šå®¢æˆ·ç«¯åŒæ—¶æ¥æ”¶æ›´æ–°

```typescript
// æ›´æ–°é€šçŸ¥æ¨é€æœåŠ¡
class UpdateNotificationService {
  private redis: Redis;
  private wsServer: WebSocketServer;

  async broadcastUpdate(channel: string, data: any): Promise<void> {
    // å‘å¸ƒåˆ°Redisé¢‘é“
    await this.redis.publish(`frontend_update:${channel}`, JSON.stringify({
      timestamp: Date.now(),
      type: 'data_update',
      payload: data
    }));

    // é€šè¿‡WebSocketç›´æ¥æ¨é€ç»™è¿æ¥çš„å®¢æˆ·ç«¯
    this.wsServer.clients.forEach(client => {
      if (client.readyState === WebSocket.OPEN) {
        client.send(JSON.stringify({
          channel,
          data,
          timestamp: Date.now()
        }));
      }
    });
  }

  // è®¢é˜…æ•°æ®åº“å˜æ›´äº‹ä»¶
  async subscribeToChanges(): Promise<void> {
    const subscriber = this.redis.duplicate();
    
    subscriber.subscribe('db_change:user_changes', 'db_change:workstation_changes');
    
    subscriber.on('message', async (channel, message) => {
      const changeEvent = JSON.parse(message);
      
      // æ ¹æ®å˜æ›´ç±»å‹æ¨é€ä¸åŒçš„æ›´æ–°
      switch (changeEvent.table) {
        case 'users':
          await this.broadcastUpdate('users', changeEvent.data);
          break;
        case 'workstations':
          await this.broadcastUpdate('workstations', changeEvent.data);
          break;
      }
    });
  }
}
```

#### 4.4.4 ç»´æŠ¤å®æ—¶æ•°æ®ä¸€è‡´æ€§

**èŒè´£æè¿°ï¼š**

* ç¡®ä¿ç¼“å­˜æ•°æ®ä¸æ•°æ®åº“æ•°æ®çš„ä¸€è‡´æ€§

* å®ç°ç¼“å­˜å¤±æ•ˆå’Œæ›´æ–°ç­–ç•¥

* å¤„ç†å¹¶å‘è®¿é—®æ—¶çš„æ•°æ®åŒæ­¥

```typescript
// æ•°æ®ä¸€è‡´æ€§ç»´æŠ¤
class DataConsistencyManager {
  private redis: Redis;
  private db: Pool;

  async ensureConsistency(key: string, fetchFromDb: () => Promise<any>): Promise<any> {
    // å°è¯•ä»ç¼“å­˜è·å–
    let data = await this.redis.get(key);
    
    if (!data) {
      // ä½¿ç”¨åˆ†å¸ƒå¼é”é˜²æ­¢ç¼“å­˜å‡»ç©¿
      const lockKey = `lock:${key}`;
      const lockAcquired = await this.redis.set(lockKey, '1', 'PX', 5000, 'NX');
      
      if (lockAcquired) {
        try {
          // ä»æ•°æ®åº“è·å–æœ€æ–°æ•°æ®
          const freshData = await fetchFromDb();
          
          // æ›´æ–°ç¼“å­˜
          await this.redis.setex(key, 3600, JSON.stringify(freshData));
          
          data = JSON.stringify(freshData);
        } finally {
          // é‡Šæ”¾é”
          await this.redis.del(lockKey);
        }
      } else {
        // ç­‰å¾…é”é‡Šæ”¾åé‡è¯•
        await new Promise(resolve => setTimeout(resolve, 100));
        return this.ensureConsistency(key, fetchFromDb);
      }
    }
    
    return JSON.parse(data);
  }

  async invalidateRelatedCache(table: string, operation: string): Promise<void> {
    const patterns = {
      users: ['user:*', 'users:list', 'dashboard:user_stats'],
      workstations: ['workstation:*', 'workstations:list', 'dashboard:workstation_stats']
    };

    const keysToInvalidate = patterns[table] || [];
    
    for (const pattern of keysToInvalidate) {
      const keys = await this.redis.keys(pattern);
      if (keys.length > 0) {
        await this.redis.del(...keys);
      }
    }
  }
}
```

#### 4.4.5 å¤„ç†é«˜å¹¶å‘è®¿é—®è¯·æ±‚

**èŒè´£æè¿°ï¼š**

* é€šè¿‡è¿æ¥æ± ç®¡ç†Redisè¿æ¥

* å®ç°è¯·æ±‚é™æµå’Œè´Ÿè½½å‡è¡¡

* ä¼˜åŒ–é«˜å¹¶å‘åœºæ™¯ä¸‹çš„æ€§èƒ½è¡¨ç°

```typescript
// é«˜å¹¶å‘å¤„ç†æœåŠ¡
class HighConcurrencyHandler {
  private redisPool: Redis[];
  private currentIndex: number = 0;

  constructor(poolSize: number = 10) {
    this.redisPool = Array.from({ length: poolSize }, () => 
      new Redis({
        host: process.env.REDIS_HOST,
        port: parseInt(process.env.REDIS_PORT),
        maxRetriesPerRequest: 3,
        retryDelayOnFailover: 100,
        lazyConnect: true
      })
    );
  }

  // è´Ÿè½½å‡è¡¡è·å–Redisè¿æ¥
  private getRedisConnection(): Redis {
    const connection = this.redisPool[this.currentIndex];
    this.currentIndex = (this.currentIndex + 1) % this.redisPool.length;
    return connection;
  }

  // æ‰¹é‡æ“ä½œä¼˜åŒ–
  async batchGet(keys: string[]): Promise<Record<string, any>> {
    const redis = this.getRedisConnection();
    const pipeline = redis.pipeline();
    
    keys.forEach(key => pipeline.get(key));
    
    const results = await pipeline.exec();
    const data: Record<string, any> = {};
    
    results.forEach(([err, result], index) => {
      if (!err && result) {
        data[keys[index]] = JSON.parse(result as string);
      }
    });
    
    return data;
  }

  // è¯·æ±‚é™æµ
  async rateLimitCheck(clientId: string, limit: number = 100): Promise<boolean> {
    const redis = this.getRedisConnection();
    const key = `rate_limit:${clientId}`;
    const current = await redis.incr(key);
    
    if (current === 1) {
      await redis.expire(key, 60); // 1åˆ†é’Ÿçª—å£
    }
    
    return current <= limit;
  }
}
```

**è·¯ç”±æ¶æ„ï¼š**

```
api/routes/
â”œâ”€â”€ auth.ts           // è®¤è¯æœåŠ¡
â”œâ”€â”€ departments.ts    // éƒ¨é—¨ç®¡ç†
â”œâ”€â”€ employees.ts      // å‘˜å·¥ä¿¡æ¯
â”œâ”€â”€ desks.ts         // å·¥ä½ç®¡ç†
â”œâ”€â”€ search.ts        // æœç´¢æœåŠ¡
â”œâ”€â”€ server-monitor.ts // ç›‘æ§æ•°æ®
â””â”€â”€ workstations.ts  // å·¥ä½œç«™ç®¡ç†
```

**æ•°æ®å±‚è®¾è®¡ï¼š**

```
api/database/
â”œâ”€â”€ connection.ts    // æ•°æ®åº“è¿æ¥æ± 
â”œâ”€â”€ models.ts       // æ•°æ®æ¨¡å‹å®šä¹‰
â”œâ”€â”€ dao.ts         // æ•°æ®è®¿é—®å±‚
â””â”€â”€ sqlite.ts      // SQLiteé€‚é…å™¨
```

## 5. å¼€å‘å’Œéƒ¨ç½²

### 5.1 å¼€å‘å‘½ä»¤

```bash
# ç‹¬ç«‹å¯åŠ¨
npm run client:dev              # éƒ¨é—¨åœ°å›¾ç³»ç»Ÿ (5173)
npm run server-management:dev   # æœåŠ¡å™¨ç®¡ç†ç³»ç»Ÿ (3000)
npm run server:dev             # åç«¯APIæœåŠ¡ (8080)

# å…¨é‡å¯åŠ¨
npm run dev:all                # åŒæ—¶å¯åŠ¨æ‰€æœ‰æœåŠ¡
```

### 5.2 æ„å»ºéƒ¨ç½²

```bash
# æ„å»ºå‘½ä»¤
npm run build                          # æ„å»ºéƒ¨é—¨åœ°å›¾ç³»ç»Ÿ
npm run build:server-management        # æ„å»ºæœåŠ¡å™¨ç®¡ç†ç³»ç»Ÿ

# é¢„è§ˆæµ‹è¯•
npm run preview                        # é¢„è§ˆéƒ¨é—¨åœ°å›¾ç³»ç»Ÿ
npm run preview:server-management      # é¢„è§ˆæœåŠ¡å™¨ç®¡ç†ç³»ç»Ÿ
```

### 5.3 é…ç½®æ–‡ä»¶è¯´æ˜

| æ–‡ä»¶                                 | ç”¨é€”        | å…³é”®é…ç½®         | ç«¯å£èŒè´£è¯´æ˜               |
| ---------------------------------- | --------- | ------------ | -------------------- |
| `vite.config.ts`                   | éƒ¨é—¨åœ°å›¾ç³»ç»Ÿé…ç½®  | ç«¯å£5173ï¼ŒAPIä»£ç† | å®Œæ•´åŠŸèƒ½é¡µé¢ï¼Œåœ°å›¾å±•ç¤ºå’Œäººå‘˜ç®¡ç†     |
| `vite.server-management.config.ts` | æœåŠ¡å™¨ç®¡ç†ç³»ç»Ÿé…ç½® | ç«¯å£3000ï¼Œç‹¬ç«‹æ„å»º  | å®Œæ•´M1æœåŠ¡å™¨ç®¡ç†é¡µé¢ï¼ŒåŒ…å«æ‰€æœ‰ç®¡ç†åŠŸèƒ½ |
| `api/server.ts`                    | APIæœåŠ¡é…ç½®   | ç«¯å£8080ï¼Œè·¯ç”±é…ç½®  | ä»…APIè°ƒç”¨ç›‘æ§ç•Œé¢ï¼Œç¦æ­¢æœåŠ¡å™¨ç®¡ç†å†…å®¹ |
| `package.json`                     | é¡¹ç›®ä¾èµ–å’Œè„šæœ¬   | å¯åŠ¨è„šæœ¬ï¼Œä¾èµ–ç®¡ç†    | å¤šç«¯å£æœåŠ¡å¯åŠ¨è„šæœ¬é…ç½®          |

**ç«¯å£é…ç½®ä¿®æ­£è¦ç‚¹**

```typescript
// vite.config.ts - éƒ¨é—¨åœ°å›¾ç³»ç»Ÿ (5173)
export default defineConfig({
  server: {
    port: 5173,
    proxy: {
      '/api': {
        target: 'http://localhost:8080',
        changeOrigin: true
      }
    }
  },
  build: {
    outDir: 'dist'
  }
})

// vite.server-management.config.ts - æœåŠ¡å™¨ç®¡ç†ç³»ç»Ÿ (3000)
export default defineConfig({
  server: {
    port: 3000,  // ç¡®ä¿ç«¯å£æ­£ç¡®
    proxy: {
      '/api': {
        target: 'http://localhost:8080',
        changeOrigin: true
      }
    }
  },
  build: {
    outDir: 'dist-server-management'  // ç‹¬ç«‹æ„å»ºç›®å½•
  }
})

// api/server.ts - APIæœåŠ¡ (8080)
const app = express();
const PORT = process.env.PORT || 8080;

// ä»…æä¾›APIç›‘æ§ç•Œé¢ï¼Œä¸åŒ…å«M1æœåŠ¡å™¨ç®¡ç†é¡µé¢
app.get('/', (req, res) => {
  res.send('APIç›‘æ§ç•Œé¢ - ä»…æ˜¾ç¤ºAPIè°ƒç”¨ç»Ÿè®¡');
});
```

## 6. æ•°æ®äº¤äº’åè®®

### 6.1 æ•°æ®åŒæ­¥æµç¨‹

**å®Œæ•´æ•°æ®åŒæ­¥æµç¨‹å›¾ï¼š**

```mermaid
graph TD
    A[3000ç«¯å£ç”¨æˆ·æ“ä½œ] --> B[æ•°æ®éªŒè¯ä¸å¤„ç†]
    B --> C[PostgreSQLæ•°æ®æ›´æ–°]
    C --> D[è§¦å‘æ•°æ®å˜æ›´äº‹ä»¶]
    D --> E[Redisç¼“å­˜å±‚æ›´æ–°]
    E --> F[WebSocketæ¨é€é€šçŸ¥]
    F --> G[5173ç«¯å£æ¥æ”¶æ›´æ–°]
    G --> H[å‰ç«¯çŠ¶æ€åŒæ­¥]
    H --> I[UIè‡ªåŠ¨åˆ·æ–°]
    
    subgraph "3000ç«¯å£ - æœåŠ¡å™¨ç®¡ç†ç³»ç»Ÿ"
        A
        B
    end
    
    subgraph "æ•°æ®å±‚"
        C
        E
    end
    
    subgraph "é€šä¿¡å±‚"
        D
        F
    end
    
    subgraph "5173ç«¯å£ - å‰ç«¯å±•ç¤º"
        G
        H
        I
        J[5173ç«¯å£ç”¨æˆ·ç™»å½•]
        L[5173ç«¯å£å·¥ä½å¡«å†™]
    end
    
    J --> K[8080ç«¯å£è®°å½•ç™»å½•ä¿¡æ¯]
    L --> M[8080ç«¯å£åŒæ­¥å·¥ä½æ•°æ®]
    
    style A fill:#e1f5fe
    style C fill:#f3e5f5
    style E fill:#fff3e0
    style I fill:#e8f5e8
    style J fill:#ffebee
    style L fill:#e8eaf6
```

**æ•°æ®æµç¨‹è¯¦ç»†è¯´æ˜ï¼š**

#### 6.1.1 ä¸»è¦æ•°æ®æµç¨‹ï¼ˆAâ†’Iï¼‰

**æœåŠ¡å™¨ç®¡ç†ç³»ç»Ÿæ•°æ®æ›´æ–°æµç¨‹ï¼š**

1. **ç”¨æˆ·æ“ä½œè§¦å‘**ï¼š3000ç«¯å£æœåŠ¡å™¨ç®¡ç†ç³»ç»Ÿæ¥æ”¶ç”¨æˆ·æ“ä½œè¯·æ±‚
2. **æ•°æ®éªŒè¯å¤„ç†**ï¼šå¯¹è¾“å…¥æ•°æ®è¿›è¡Œæ ¼å¼éªŒè¯ã€æƒé™æ£€æŸ¥å’Œä¸šåŠ¡é€»è¾‘å¤„ç†
3. **æ•°æ®åº“æ›´æ–°**ï¼šå°†éªŒè¯åçš„æ•°æ®å†™å…¥PostgreSQLä¸»æ•°æ®åº“
4. **å˜æ›´äº‹ä»¶è§¦å‘**ï¼šæ•°æ®åº“è§¦å‘å™¨äº§ç”ŸNOTIFYäº‹ä»¶ï¼Œé€šçŸ¥ç³»ç»Ÿæ•°æ®å·²å˜æ›´
5. **ç¼“å­˜å±‚åŒæ­¥**ï¼šRedisç¼“å­˜å±‚æ¥æ”¶å˜æ›´é€šçŸ¥ï¼Œæ›´æ–°ç›¸å…³ç¼“å­˜æ•°æ®
6. **å®æ—¶æ¨é€**ï¼šWebSocketæœåŠ¡ç›‘å¬Rediså˜æ›´ï¼Œå‘æ‰€æœ‰è¿æ¥çš„å®¢æˆ·ç«¯æ¨é€æ›´æ–°é€šçŸ¥
7. **å‰ç«¯æ¥æ”¶**ï¼š5173ç«¯å£å‰ç«¯ç³»ç»Ÿé€šè¿‡WebSocketè¿æ¥æ¥æ”¶å®æ—¶æ›´æ–°
8. **çŠ¶æ€åŒæ­¥**ï¼šå‰ç«¯åº”ç”¨çŠ¶æ€ç®¡ç†å™¨æ›´æ–°æœ¬åœ°çŠ¶æ€æ•°æ®
9. **ç•Œé¢åˆ·æ–°**ï¼šReactç»„ä»¶é‡æ–°æ¸²æŸ“ï¼Œç”¨æˆ·ç•Œé¢è‡ªåŠ¨æ›´æ–°æ˜¾ç¤ºæœ€æ–°æ•°æ®

#### 6.1.2 è¾…åŠ©æ•°æ®æµç¨‹ï¼ˆJâ†’K, Lâ†’Mï¼‰

**å‰ç«¯ä¸APIæœåŠ¡äº¤äº’ï¼š**

* **ç”¨æˆ·ç™»å½•æµç¨‹**ï¼š5173ç«¯å£ç”¨æˆ·ç™»å½•æ“ä½œé€šè¿‡8080ç«¯å£APIæœåŠ¡è®°å½•ç™»å½•ä¿¡æ¯

* **å·¥ä½æ•°æ®åŒæ­¥**ï¼š5173ç«¯å£å·¥ä½å¡«å†™æ“ä½œé€šè¿‡8080ç«¯å£APIæœåŠ¡åŒæ­¥å·¥ä½æ•°æ®

#### 6.1.3 ç³»ç»Ÿåˆ†å±‚æ¶æ„

**å„å±‚èŒè´£æ˜ç¡®ï¼š**

* **3000ç«¯å£æœåŠ¡å™¨ç®¡ç†ç³»ç»Ÿ**ï¼šè´Ÿè´£ç®¡ç†å‘˜æ“ä½œå’Œæ•°æ®å¤„ç†

* **æ•°æ®å±‚**ï¼šPostgreSQLä¸»æ•°æ®åº“å’ŒRedisç¼“å­˜å±‚ååŒå·¥ä½œ

* **é€šä¿¡å±‚**ï¼šWebSocketå®æ—¶é€šä¿¡å’ŒAPIæœåŠ¡æ•°æ®äº¤äº’

* **5173ç«¯å£å‰ç«¯å±•ç¤º**ï¼šç”¨æˆ·ç•Œé¢å±•ç¤ºå’Œäº¤äº’æ“ä½œ

**æ•°æ®åŒæ­¥æ—¶åºå›¾ï¼š**

```mermaid
sequenceDiagram
    participant U as ç”¨æˆ·(3000ç«¯å£)
    participant S as æœåŠ¡å™¨ç®¡ç†ç³»ç»Ÿ
    participant P as PostgreSQL
    participant R as Redisç¼“å­˜
    participant W as WebSocketæœåŠ¡
    participant F as å‰ç«¯(5173ç«¯å£)
    
    U->>S: ä¿®æ”¹ç”¨æˆ·æ•°æ®
    S->>S: æ•°æ®éªŒè¯
    S->>P: æ‰§è¡Œæ•°æ®åº“æ›´æ–°
    P-->>S: æ›´æ–°æˆåŠŸç¡®è®¤
    
    S->>R: æ›´æ–°ç¼“å­˜æ•°æ®
    R-->>S: ç¼“å­˜æ›´æ–°å®Œæˆ
    
    S->>W: å‘é€å˜æ›´é€šçŸ¥
    W->>F: WebSocketæ¨é€æ›´æ–°äº‹ä»¶
    F->>F: æ›´æ–°æœ¬åœ°çŠ¶æ€
    F->>F: é‡æ–°æ¸²æŸ“UI
    
    Note over U,F: æ•´ä¸ªæµç¨‹è€—æ—¶ < 500ms
    Note over P,R: æ•°æ®ä¸€è‡´æ€§ä¿è¯
    Note over W,F: å®æ—¶åŒæ­¥æœºåˆ¶
```

### 6.2 è®¤è¯æœºåˆ¶

```typescript
// JWT Tokenè®¤è¯
const headers = {
  'Authorization': `Bearer ${token}`,
  'Content-Type': 'application/json'
};

// APIè°ƒç”¨ç¤ºä¾‹
const response = await fetch('/api/search?q=query', { headers });
```

### 6.2 æœç´¢API

```typescript
// è¯·æ±‚æ ¼å¼
GET /api/search?q={query}

// å“åº”æ ¼å¼
{
  "success": true,
  "data": {
    "employees": [...],
    "workstations": [...],
    "total": 10
  }
}
```

### 6.3 ç›‘æ§æ•°æ®API

```typescript
// WebSocketè¿æ¥
const ws = new WebSocket('ws://localhost:8080/monitor');

// å®æ—¶æ•°æ®æ ¼å¼
{
  "type": "server_status",
  "data": {
    "cpu": 45.2,
    "memory": 68.1,
    "disk": 32.5,
    "network": 78.3
  }
}
```

### 6.4 WebSocketå¤šè¿æ¥ç®¡ç†ä¸äº¤äº’é“¾è·¯

#### 6.4.1 WebSocketè¿æ¥æ¶æ„

```mermaid
sequenceDiagram
    participant Client as å®¢æˆ·ç«¯æµè§ˆå™¨
    participant WS as WebSocketæœåŠ¡
    participant CM as è¿æ¥ç®¡ç†å™¨
    participant MB as æ¶ˆæ¯å¹¿æ’­å™¨
    participant Pool as PostgreSQLè¿æ¥æ± 
    participant DB as PostgreSQLæ•°æ®åº“
    participant Redis as Redisç¼“å­˜
    
    Client->>WS: å»ºç«‹WebSocketè¿æ¥
    WS->>CM: æ³¨å†Œæ–°è¿æ¥
    CM->>Pool: è·å–æ•°æ®åº“è¿æ¥
    Pool->>DB: å»ºç«‹æ•°æ®åº“è¿æ¥
    
    Note over WS,MB: å®æ—¶æ•°æ®ç›‘æ§å¾ªç¯
    loop æ¯3ç§’
        WS->>Pool: æŸ¥è¯¢ç³»ç»ŸæŒ‡æ ‡
        Pool->>DB: æ‰§è¡Œç›‘æ§æŸ¥è¯¢
        DB-->>Pool: è¿”å›ç³»ç»Ÿæ•°æ®
        Pool-->>WS: è¿”å›æŒ‡æ ‡æ•°æ®
        WS->>MB: å‡†å¤‡å¹¿æ’­æ¶ˆæ¯
        MB->>Client: æ¨é€å®æ—¶æ•°æ®
    end
    
    Note over DB,WS: æ•°æ®å˜æ›´é€šçŸ¥
    DB->>WS: NOTIFYäº‹ä»¶è§¦å‘
    WS->>MB: å¤„ç†å˜æ›´äº‹ä»¶
    MB->>Client: æ¨é€å˜æ›´é€šçŸ¥
    
    Client->>WS: æ–­å¼€è¿æ¥
    WS->>CM: æ¸…ç†è¿æ¥èµ„æº
    CM->>Pool: é‡Šæ”¾æ•°æ®åº“è¿æ¥
    CM->>Redis: æ¸…ç†ä¼šè¯æ•°æ®
```

#### 6.4.2 å¤šè¿æ¥ç®¡ç†æœºåˆ¶

**è¿æ¥ç”Ÿå‘½å‘¨æœŸç®¡ç†**

* **è¿æ¥å»ºç«‹**ï¼šè‡ªåŠ¨åˆ†é…è¿æ¥IDï¼Œè®¾ç½®å¿ƒè·³æ£€æµ‹

* **è¿æ¥ç›‘æ§**ï¼šå®æ—¶è·Ÿè¸ªè¿æ¥çŠ¶æ€ã€æ¶ˆæ¯è®¡æ•°ã€æœ€åæ´»åŠ¨æ—¶é—´

* **è¿æ¥æ¸…ç†**ï¼šè‡ªåŠ¨æ¸…ç†è¶…æ—¶è¿æ¥ï¼ˆ5åˆ†é’Ÿæ— æ´»åŠ¨ï¼‰

* **è´Ÿè½½å‡è¡¡**ï¼šé™åˆ¶å•IPæœ€å¤§è¿æ¥æ•°ï¼ˆ10ä¸ªï¼‰ï¼Œæ€»è¿æ¥æ•°ä¸Šé™ï¼ˆ1000ä¸ªï¼‰

**è¿æ¥æ± é…ç½®ä¼˜åŒ–**

* **æœ€å¤§è¿æ¥æ•°**ï¼š20ä¸ªå¹¶å‘æ•°æ®åº“è¿æ¥

* **æœ€å°è¿æ¥æ•°**ï¼š5ä¸ªä¿æŒæ´»è·ƒè¿æ¥

* **ç©ºé—²è¶…æ—¶**ï¼š30ç§’è‡ªåŠ¨å›æ”¶ç©ºé—²è¿æ¥

* **è¿æ¥å¤ç”¨**ï¼šå•ä¸ªè¿æ¥æœ€å¤§ä½¿ç”¨7500æ¬¡åé‡å»º

#### 6.4.3 å®æ—¶æ•°æ®åŒæ­¥æœºåˆ¶

**PostgreSQL NOTIFY/LISTENæœºåˆ¶**

* **æ•°æ®å˜æ›´ç›‘å¬**ï¼šç›‘å¬æ•°æ®åº“è¡¨çš„INSERTã€UPDATEã€DELETEäº‹ä»¶

* **å®æ—¶æ¨é€**ï¼šé€šè¿‡WebSocketç«‹å³æ¨é€å˜æ›´é€šçŸ¥ç»™å®¢æˆ·ç«¯

* **äº‹ä»¶è¿‡æ»¤**ï¼šæ ¹æ®ç”¨æˆ·æƒé™è¿‡æ»¤æ¨é€å†…å®¹

**Redisç¼“å­˜é›†æˆ**

* **ä¼šè¯ç®¡ç†**ï¼šå­˜å‚¨WebSocketè¿æ¥ä¼šè¯ä¿¡æ¯

* **æ¶ˆæ¯é˜Ÿåˆ—**ï¼šç¼“å­˜å¾…æ¨é€çš„æ¶ˆæ¯ï¼Œç¡®ä¿æ¶ˆæ¯ä¸ä¸¢å¤±

* **æ€§èƒ½ä¼˜åŒ–**ï¼šç¼“å­˜é¢‘ç¹æŸ¥è¯¢çš„ç›‘æ§æ•°æ®ï¼Œå‡å°‘æ•°æ®åº“å‹åŠ›

> ğŸ“‹ **è¯¦ç»†æŠ€æœ¯å®ç°è¯·å‚è€ƒ**ï¼š[WebSocketä¸PostgreSQLç»„ä»¶å…³è”æŠ€æœ¯æ–‡æ¡£](./WebSocketä¸PostgreSQLç»„ä»¶å…³è”æŠ€æœ¯æ–‡æ¡£.md)

## 7. æœ€ä½³å®è·µ

### 7.1 ä»£ç è§„èŒƒ

* **ç»„ä»¶è®¾è®¡**ï¼šå•ä¸€èŒè´£ï¼Œé«˜å†…èšä½è€¦åˆ

* **çŠ¶æ€ç®¡ç†**ï¼šä½¿ç”¨React Contextæˆ–Zustandè¿›è¡ŒçŠ¶æ€ç®¡ç†

* **é”™è¯¯å¤„ç†**ï¼šç»Ÿä¸€çš„é”™è¯¯è¾¹ç•Œå’Œå¼‚å¸¸å¤„ç†æœºåˆ¶

* **ç±»å‹å®‰å…¨**ï¼šå……åˆ†åˆ©ç”¨TypeScriptç±»å‹ç³»ç»Ÿ

### 7.2 æ€§èƒ½ä¼˜åŒ–

* **ä»£ç åˆ†å‰²**ï¼šä½¿ç”¨React.lazyè¿›è¡Œç»„ä»¶æ‡’åŠ è½½

* **ç¼“å­˜ç­–ç•¥**ï¼šåˆç†ä½¿ç”¨æµè§ˆå™¨ç¼“å­˜å’ŒRedisç¼“å­˜

* **èµ„æºä¼˜åŒ–**ï¼šå›¾ç‰‡å‹ç¼©ï¼ŒCSS/JSå‹ç¼©å’Œåˆå¹¶

* **ç›‘æ§å‘Šè­¦**ï¼šå®æ—¶æ€§èƒ½ç›‘æ§å’Œå¼‚å¸¸å‘Šè­¦

### 7.3 å®‰å…¨è€ƒè™‘

* **è¾“å…¥éªŒè¯**ï¼šå‰åç«¯åŒé‡æ•°æ®éªŒè¯

* **æƒé™æ§åˆ¶**ï¼šåŸºäºè§’è‰²çš„è®¿é—®æ§åˆ¶(RBAC)

* **å®‰å…¨å¤´éƒ¨**ï¼šä½¿ç”¨Helmet.jsè®¾ç½®å®‰å…¨HTTPå¤´

* **HTTPSéƒ¨ç½²**ï¼šç”Ÿäº§ç¯å¢ƒå¼ºåˆ¶ä½¿ç”¨HTTPS

## 8. ç»´æŠ¤æŒ‡å—

### 8.1 ç‰ˆæœ¬ç®¡ç†

* é‡‡ç”¨**è¯­ä¹‰åŒ–ç‰ˆæœ¬æ§åˆ¶**(Semantic Versioning)

* é‡è¦ä¿®æ”¹éœ€æ›´æ–°`CHANGELOG.md`

* Gitæäº¤ä¿¡æ¯æ ¼å¼ï¼š`type(scope): description`

### 8.2 ç›‘æ§è¿ç»´

* **æ€§èƒ½ç›‘æ§**ï¼šé¡µé¢åŠ è½½æ—¶é—´ã€APIå“åº”æ—¶é—´

* **é”™è¯¯ç›‘æ§**ï¼šå‰ç«¯é”™è¯¯æ•è·ã€åç«¯å¼‚å¸¸æ—¥å¿—

* **ä¸šåŠ¡ç›‘æ§**ï¼šç”¨æˆ·è¡Œä¸ºåˆ†æã€åŠŸèƒ½ä½¿ç”¨ç»Ÿè®¡

### 8.3 æ•…éšœå¤„ç†

1. **é—®é¢˜å®šä½**ï¼šæŸ¥çœ‹æ—¥å¿—ï¼Œç¡®å®šå½±å“èŒƒå›´
2. **å¿«é€Ÿæ¢å¤**ï¼šå›æ»šåˆ°ç¨³å®šç‰ˆæœ¬
3. **æ ¹å› åˆ†æ**ï¼šæ·±å…¥åˆ†æé—®é¢˜åŸå› 
4. **é¢„é˜²æªæ–½**ï¼šå®Œå–„ç›‘æ§å’Œæµ‹è¯•è¦†ç›–

***

## 9. ç›¸å…³æŠ€æœ¯æ–‡æ¡£

### 9.1 ç»„ä»¶å…³è”æŠ€æœ¯æ–‡æ¡£

* [WebSocketä¸PostgreSQLç»„ä»¶å…³è”æŠ€æœ¯æ–‡æ¡£](./WebSocketä¸PostgreSQLç»„ä»¶å…³è”æŠ€æœ¯æ–‡æ¡£.md) - è¯¦ç»†æè¿°WebSocketæœåŠ¡ä¸PostgreSQLæ•°æ®åº“çš„æŠ€æœ¯å…³è”å®ç°

* [M1é˜¶æ®µAPIæ¥å£æ–‡æ¡£](./M1/M1_APIæ¥å£æ–‡æ¡£.md) - M1é˜¶æ®µçš„APIæ¥å£è§„èŒƒå’Œä½¿ç”¨è¯´æ˜

### 9.2 æ–‡æ¡£ç»´æŠ¤è¯´æ˜

æœ¬æ–‡æ¡£ä¸ç›¸å…³æŠ€æœ¯æ–‡æ¡£ä¿æŒåŒæ­¥æ›´æ–°ï¼Œç¡®ä¿æ¶æ„ä¿¡æ¯çš„ä¸€è‡´æ€§å’Œå®Œæ•´æ€§ã€‚å½“ç³»ç»Ÿæ¶æ„å‘ç”Ÿå˜æ›´æ—¶ï¼Œéœ€è¦åŒæ—¶æ›´æ–°ç›¸å…³çš„æŠ€æœ¯æ–‡æ¡£ã€‚

***

**æ–‡æ¡£ä¿¡æ¯**

* **ç‰ˆæœ¬**: v2.4.0

* **åˆ›å»º**: 2024-01-25

* **æ›´æ–°**: 2024-12-19

* **ç»´æŠ¤**: ç³»ç»Ÿæ¶æ„å›¢é˜Ÿ

**v2.4.0 æ›´æ–°å†…å®¹**

* é›†æˆå®Œæ•´çš„ç³»ç»Ÿæ•°æ®æµç¨‹å›¾ï¼Œå±•ç¤º3000ç«¯å£ã€5173ç«¯å£ã€8080ç«¯å£é—´çš„äº¤äº’å…³ç³»

* æ·»åŠ æ•°æ®å±‚ã€é€šä¿¡å±‚ã€å‰ç«¯å±•ç¤ºå±‚çš„åˆ†å±‚æ¶æ„å¯è§†åŒ–

* è¡¥å……ä¸»è¦æ•°æ®æµç¨‹ï¼ˆAâ†’Iï¼‰å’Œè¾…åŠ©æ•°æ®æµç¨‹ï¼ˆJâ†’K, Lâ†’Mï¼‰çš„è¯¦ç»†è¯´æ˜

* ä¼˜åŒ–æ•°æ®åŒæ­¥æµç¨‹æè¿°ï¼ŒåŒ…å«9ä¸ªå…³é”®æ­¥éª¤çš„å®Œæ•´è¯´æ˜

* æ˜ç¡®å„ç³»ç»Ÿå±‚çº§èŒè´£å’Œæ•°æ®æµè½¬æœºåˆ¶

**v2.3.0 æ›´æ–°å†…å®¹**

* è¯¦ç»†è¡¥å……3000ç«¯å£ServerManagementRoot.tsxäº”å¤§æ ¸å¿ƒæ¨¡å—åŠŸèƒ½

* æ·»åŠ å®Œæ•´æ•°æ®åŒæ­¥æµç¨‹mermaidå›¾ï¼ˆæµç¨‹å›¾+æ—¶åºå›¾ï¼‰

* è¯¦ç»†è¯´æ˜RedisæœåŠ¡äº”å¤§èŒè´£åŠå®ç°ä»£ç 

* ä¼˜åŒ–PostgreSQLæ•°æ®åº“ä¿¡æ¯åæ˜ å’Œå®æ—¶åŒæ­¥æœºåˆ¶

* å®Œå–„WebSocketå¤šè¿æ¥ç®¡ç†ä¸äº¤äº’é“¾è·¯æ¶æ„

