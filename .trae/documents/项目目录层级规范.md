# 项目目录层级规范

## 1. 项目整体架构

```
部门地图/
├── src/                    # 前端源码 (5173端口)
│   ├── components/         # React组件
│   ├── pages/             # 页面组件
│   ├── hooks/             # 自定义钩子
│   ├── utils/             # 工具函数
│   └── assets/            # 静态资源
├── api/                   # 后端API服务 (8080端口)
│   ├── routes/            # API路由
│   ├── middleware/        # 中间件
│   ├── models/            # 数据模型
│   └── utils/             # 后端工具
├── public/                # 静态文件
├── supabase/              # Supabase配置
│   └── migrations/        # 数据库迁移
├── .trae/                 # 项目文档
│   └── documents/         # 技术文档
├── server-management.html # 服务器管理页面 (3000端口)
├── server-management-new.html # 新版服务器管理页面
├── index.html             # 主页面入口
├── vite.config.ts         # 主应用配置 (5173端口)
├── vite.server-management.config.ts # 服务器管理配置 (3000端口)
└── package.json           # 项目依赖
```

## 2. 端口分配规范

### 端口 5173 - 主应用 (React + Vite)
- **配置文件**: `vite.config.ts`
- **启动命令**: `npm run client:dev`
- **入口文件**: `index.html`
- **源码目录**: `src/`
- **用途**: 主要的React应用，包含地图功能、用户界面等

### 端口 3000 - 服务器管理界面
- **配置文件**: `vite.server-management.config.ts`
- **启动命令**: `npm run server-management:dev`
- **页面文件**: `server-management.html`, `server-management-new.html`
- **用途**: 服务器管理和监控界面

### 端口 8080 - 后端API服务
- **配置文件**: `server.ts`, `api/app.ts`
- **启动命令**: `npm run server:dev`
- **源码目录**: `api/`
- **用途**: 提供REST API服务，不提供静态文件

## 3. 路由映射规范

### 3.1 端口 5173 路由
```
http://localhost:5173/
├── /                      # 主页
├── /map                   # 地图页面
├── /workstations          # 工位管理
├── /users                 # 用户管理
└── /settings              # 设置页面
```

### 3.2 端口 3000 路由
```
http://localhost:3000/
├── /                      # 服务器管理主页 (server-management.html)
├── /index.html            # 同上
├── /server-management.html # 同上
├── /server-management     # 新版服务器管理界面 (server-management-new.html)
└── /server-management-main # 404 - 已废弃路径
```

### 3.3 端口 8080 API路由
```
http://localhost:8080/
├── /api/auth              # 认证相关API
├── /api/workstations      # 工位相关API
├── /api/users             # 用户相关API
├── /api/maps              # 地图相关API
├── /api/monitoring        # 监控相关API
├── /api/architecture      # 系统架构API
└── /api/health            # 健康检查API
```

## 4. 文件命名规范

### 4.1 HTML文件
- `index.html` - 主应用入口
- `server-management.html` - 服务器管理页面 (旧版)
- `server-management-new.html` - 服务器管理页面 (新版)

### 4.2 配置文件
- `vite.config.ts` - 主应用Vite配置
- `vite.server-management.config.ts` - 服务器管理应用配置
- `package.json` - 项目依赖和脚本

### 4.3 源码文件
- React组件: PascalCase (如 `UserCard.tsx`)
- 工具函数: camelCase (如 `formatDate.ts`)
- 页面组件: PascalCase (如 `MapPage.tsx`)

## 5. 版本迭代规范

### 5.1 版本命名
- 遵循语义化版本控制 (SemVer)
- 格式: `v主版本.次版本.修订版_功能描述`
- 示例: `v1.2.3_optimize_routing`

### 5.2 文件版本管理
- 新功能文件添加版本后缀 (如 `server-management-new.html`)
- 旧版本文件保留但标记为废弃
- 通过路由配置控制访问权限

### 5.3 迁移策略
- 渐进式迁移，保持向后兼容
- 新版本优先，旧版本逐步废弃
- 明确的废弃时间表和通知

## 6. 开发环境配置

### 6.1 启动顺序
1. `npm run server:dev` - 启动后端API服务 (8080)
2. `npm run client:dev` - 启动主应用 (5173)
3. `npm run server-management:dev` - 启动服务器管理界面 (3000)

### 6.2 代理配置
- 主应用 (5173) 代理 `/api` 到 8080 端口
- 服务器管理 (3000) 代理 `/api` 到 8080 端口
- 确保API调用的一致性

## 7. 部署规范

### 7.1 构建输出
- 主应用: `dist/` 目录
- 服务器管理: `dist-server-management/` 目录
- API服务: 直接运行 TypeScript 或编译后的 JavaScript

### 7.2 静态文件服务
- 生产环境使用 Nginx 或类似服务器
- API服务不提供静态文件服务
- 明确的服务边界和职责分离

## 8. 注意事项

### 8.1 路径冲突避免
- 避免在不同端口使用相同的路径名
- 使用明确的路径前缀区分功能模块
- 定期检查和清理废弃路径

### 8.2 配置文件管理
- 每个端口使用独立的配置文件
- 避免配置冲突和相互影响
- 保持配置的简洁和可维护性

### 8.3 文档同步
- 路由变更时及时更新文档
- 保持代码和文档的一致性
- 定期审查和优化项目结构
