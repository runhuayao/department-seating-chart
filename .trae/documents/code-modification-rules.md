# 代码修改流程规范 v2.0

## 概述

本文档定义了针对v2.0及以上版本的代码修改流程规范，确保代码质量、可追溯性和团队协作效率。

## 核心原则

### 1. 文档先行
- 任何代码修改前必须先更新或创建相应的技术文档
- 文档必须包含完整的上下文信息：修改背景、目的和影响范围
- 技术文档存放在 `.trae/documents/` 目录下

### 2. 分步记录
- 采用分步记录方式，确保每个操作步骤都可追溯
- 使用TODO列表管理复杂任务的执行进度
- 每个步骤完成后及时更新状态

### 3. 问题管理
- 对重复出现但未彻底解决的问题，必须在本规范文档中明确标注
- 设置提醒机制，防止问题被遗忘
- 建立问题跟踪表，记录问题状态和解决方案

## 修改流程

### 阶段一：需求分析和文档准备
1. **需求理解**
   - 仔细分析用户需求
   - 识别影响范围和技术难点
   - 评估风险和资源需求

2. **文档创建/更新**
   - 创建或更新技术规范文档
   - 包含背景、目的、影响范围、实现方案
   - 文档必须经过审核确认

### 阶段二：开发计划制定
1. **任务分解**
   - 将复杂任务分解为可管理的小任务
   - 使用TODO工具跟踪任务进度
   - 设置任务优先级和依赖关系

2. **技术方案设计**
   - 详细的技术实现方案
   - 数据库变更计划
   - API接口设计
   - 前端组件架构

### 阶段三：代码实现
1. **开发规范**
   - 遵循TypeScript最佳实践
   - 保持代码可读性和可维护性
   - 及时添加注释和文档

2. **质量控制**
   - 每次提交前运行 `npm run check`
   - 确保TypeScript编译无错误
   - 进行基本功能测试

### 阶段四：测试和验证
1. **功能测试**
   - 单元测试
   - 集成测试
   - 用户界面测试

2. **性能验证**
   - 数据库查询性能
   - 前端加载速度
   - 并发处理能力

### 阶段五：部署和监控
1. **部署准备**
   - 更新CHANGELOG.md
   - 准备回滚方案
   - 通知相关人员

2. **监控和维护**
   - 部署后监控系统状态
   - 收集用户反馈
   - 及时处理问题

## 文档管理规范

### 文档结构
```
.trae/documents/
├── v2.0-technical-specification.md    # 技术规范
├── code-modification-rules.md          # 本文档
├── known-issues.md                     # 已知问题跟踪
├── api-documentation.md                # API文档
└── deployment-guide.md                 # 部署指南
```

### 文档更新要求
- 每次代码修改必须同步更新相关文档
- 文档版本号与代码版本保持一致
- 重要变更必须在CHANGELOG.md中记录

## 已知问题跟踪

### 当前已知问题

#### 1. 部门映射搜索功能异常
- **问题描述**: 系统仅能检索到技术部人员，其他部门人员无法通过搜索功能查询
- **影响范围**: DepartmentMappingManager.tsx, 搜索API
- **状态**: 待解决
- **优先级**: 高
- **解决方案**: 重建PostgreSQL全量索引
- **提醒**: 每次搜索功能修改时必须验证所有部门数据

#### 2. 前端数据源不规范
- **问题描述**: 使用虚拟文件作为数据源，未与数据库保持严格同步
- **影响范围**: 所有前端组件
- **状态**: 待解决
- **优先级**: 高
- **解决方案**: 实现基于SQL查询的缓存文件系统
- **提醒**: 禁止使用虚拟文件，必须使用数据库查询结果

#### 3. TypeScript类型定义不一致
- **问题描述**: 不同组件中的接口定义存在差异
- **影响范围**: 多个组件文件
- **状态**: 部分解决
- **优先级**: 中
- **解决方案**: 统一类型定义，创建共享类型文件
- **提醒**: 新增接口时必须检查是否与现有定义冲突

### 问题跟踪流程
1. **问题发现**: 立即记录到本文档
2. **影响评估**: 评估问题影响范围和优先级
3. **解决方案**: 制定详细的解决方案
4. **状态跟踪**: 定期更新问题状态
5. **验证确认**: 问题解决后进行全面验证

## Git版本管理规范

### 提交信息格式
```
<type>(<scope>): <subject>

<body>

<footer>
```

### 提交类型
- `feat`: 新功能
- `fix`: 错误修复
- `docs`: 文档更新
- `style`: 代码格式调整
- `refactor`: 代码重构
- `test`: 测试相关
- `chore`: 构建过程或辅助工具的变动

### 分支管理
- `main`: 主分支，稳定版本
- `develop`: 开发分支
- `feature/*`: 功能分支
- `hotfix/*`: 紧急修复分支

## 质量保证

### 代码审查
- 所有代码修改必须经过审查
- 重点检查类型安全、性能影响、安全性
- 确保符合项目编码规范

### 自动化检查
- TypeScript编译检查
- ESLint代码规范检查
- 单元测试执行
- 构建流程验证

## 应急处理

### 紧急问题处理流程
1. **问题识别**: 快速识别问题影响范围
2. **临时方案**: 实施临时解决方案
3. **根本修复**: 制定并实施根本解决方案
4. **文档更新**: 更新相关文档和规范
5. **预防措施**: 建立预防类似问题的机制

## 规范更新

本规范文档将根据项目发展和团队反馈持续更新。重大变更将通过团队讨论确定，并在CHANGELOG.md中记录。

---

**文档版本**: v2.0  
**最后更新**: 2024-01-15  
**下次审核**: 2024-02-15  
**维护人员**: SOLO Coding
